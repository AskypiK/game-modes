/**
 * RoyalSquad team UI
 */
#Const Version    "2018-06-25"
#Const ScriptName "ManiaApps/Nadeo/TeamSelection_Client2.Script.txt"

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// Libraries
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
#Include "TextLib" as TL
#Include "ManiaApps/Nadeo/Layers.Script.txt" as Layers
#Include "Libs/Nadeo/ShootMania/Royal/Constants2.Script.txt" as Const

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// Constants
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
#Const C_Layer_TeamSelection "MultiPlayer_TeamSelection"

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// Functions
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// Private
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
/** Get the manialink of the RoyalSquad UI
 *
 *  @return                           RoyalSquad UI manialink
 */
Text Private_GetTeamSelectionML() {
	///For Localisation
	//L16N [Royal] Used to tell the players that they can capture the pole
	declare RoyalSquad_PressHToShowHelp_Text = _("Press H to show help");
	//L16N [Royal] Used to tell the players that they can press ready to play
	declare RoyalSquad_Ready_Text = _("READY");
	//L16N [Royal] Used to tell the players that they can press cancel to cancel the ready button
	declare RoyalSquad_Cancel_Text = _("CANCEL");
	//L16N [Royal] Used to launch the matchmaking process
	declare RoyalSquad_STARTMATCHMAKING_Text = _("START MATCHMAKING");
	//L16N [Royal] Tell the players he can play solo
	declare RoyalSquad_GOSOLO_Text = _("PLAY SOLO");
	//L16N [Royal] Used for a button to hide the menu
	declare RoyalSquad_HideMenu_Text = _("Hide Menu");
	//L16N [Royal] Used to tell the player to go back to the game after opening the squads menu
	declare RoyalSquad_BackToGame_Text = _("BACK TO GAME");
	//L16N [Royal] Used for a button to show the menu
	declare RoyalSquad_ShowMenu_Text = _("Show Menu");
	//L16N [Royal] Used to set the "type" of team you want automatically means that the team will be fill by the system
	declare RoyalSquad_PublicTeam_Text = _("Automatically");
	//L16N [Royal] Used to set the "type" of team you want automatically means that the team will be fill by the player with invitation
	declare RoyalSquad_PrivateTeam_Text = _("Invite only");
	//L16N [Royal] Used to tell the players that the system is searching a team to send him in
	declare RoyalSquad_SearchingForTeam_Text = _("Searching for Squad");
	//L16N [Royal] Used to tell the players that they are waiting for the team to be completed
	declare RoyalSquad_WaitingForTeamToComplete_Text = _("Waiting for Squad to complete");
	//L16N [Royal] Used to tell the players that they are waiting for other players to create a team
	declare RoyalSquad_SearchingForPlayers_Text = _("Searching for Players");
	//L16N [Royal] Used to tell the players that he have to press ready to play the next round
	declare RoyalSquad_PressReady_Text = _("Press ready for next round");
	//L16N [Royal] Used to tell the players that there team is now complete
	declare RoyalSquad_TeamIsComplete_Text = _("Squad is complete");
	//L16N [Royal] Used to tell the players that there team is now complete
	declare RoyalSquad_TeamSolo_Text = _("Playing solo");
	//L16N [Royal] Used to tell the players that they have to wait until the next round to play
	declare RoyalSquad_WaitForNextRound_Text = _("Wait for next round");
	//L16N [Royal] Used to tell the players that they can click on the button to create a Squad
	declare RoyalSquad_CreateTeam_Text = _("CREATE SQUAD");
	//L16N [Royal] Used to tell the players that they can click on the button to leave their team
	declare RoyalSquad_LeaveTeam_Text = _("Leave Squad");
	//L16N [Royal] Used in a menu with the list of players to invite them in your team
	declare RoyalSquad_Invite_Text = _("Invite");
	//L16N [Royal] Used in a menu for the Friends list on the server
	declare RoyalSquad_Friends_Text = _("Friends");
	//L16N [Royal] Tell the players that they have no friends on the server
	declare RoyalSquad_NoFriends_Text = _("No Friends");
	//L16N [Royal] Used in a menu for the list of all players in the server
	declare RoyalSquad_Players_Text = _("Players");
	//L16N [Royal] Used in a menu for the list of the invitations received by the player
	declare RoyalSquad_Invitations_Text = _("Invitations");
	//L16N [Royal] Used in a menu for the list of invitations is empty
	declare RoyalSquad_NoInvitation_Text = _("No Invitation");
	//L16N [Royal] Tell the players that they can click on the invitation to accept it
	declare RoyalSquad_ClickToAccept_Text = _("click to accept");
	//L16N [Royal] Tell the players that their team is below this text
	declare RoyalSquad_YourTeam_Text = _("Your Squad");
	//L16N [Royal] Tell the players that a player is already in a team
	declare RoyalSquad_InATeam_Text = _("In a Squad");
	//L16N [Royal] Tell the players that a player is already in a team
	declare RoyalSquad_InYourTeam_Text = _("In Your Squad");
	//L16N [Royal] Tell the players that they can click on a player name to invite
	declare RoyalSquad_ClickToInvite_Text = _("click to invite");
	//L16N [Royal] Tell the players that a mate is recquired in the block
	declare RoyalSquad_EmptySlot_Text = _("Empty slot");
	//L16N [Royal] Tell the players that the player can check an option to customize matchmaking options
	declare RoyalSquad_CustomMatchMaking_Text = _("custom matchmaking");
	//L16N [Royal] Tell the players that the player can check the remaining places in the matchmaking options selected
	declare RoyalSquad_RemainingPlaces_Text = _("Remaining places");
	//L16N [Royal] In the squad creation menu, the player can choose how he want his team to be filled
	declare RoyalSquad_Filling_Text = _("Filling");
	//L16N [Royal] In the squad creation menu, means the places maximum in the team of the player
	declare RoyalSquad_Slots_Text = _("Slots");
	//L16N [Royal] In the game, used to tell the player to open the squad menu while he is spawned
	declare RoyalSquad_SquadMenu_Text = _("Squad Menu");
	//L16N [Royal] When the player hide the squad UI, reminds him that he is in an uncomplete team
	declare RoyalSquad_UnFullTeam_Text = _("Unfull Team");
	//L16N [Royal] When the player hide the squad UI, reminds him that he isn't in a team
	declare RoyalSquad_NoTeam_Text = _("No Team");
	//// IMAGES FOR MANIALINK
	declare Img_LeavePorte = "file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSETS_UI_ICONES_Leave_Porte.dds";
	declare Img_LeaveArrow = "file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSETS_UI_ICONES_Leave_fleche.dds";
	declare Img_CadreReady = "file://Media/ManiaLinks/Nadeo/TeamSelectionModule/ASSET_UI_SquadRoyal_Frame_Ready.dds";
	declare Img_CadreValidate = "file://Media/ManiaLinks/Nadeo/TeamSelectionModule/ASSETS_512x512_SquadRoyal_Tuto_CadreValidate.dds";
	declare Img_CadreTuto_Score = "file://Media/ManiaLinks/Nadeo/TeamSelectionModule/ASSETS_512x512_SquadRoyal_Tuto_CadreScore.dds";
	declare Img_CadreReady_V2 = "file://Media/ManiaLinks/Nadeo/TeamSelectionModule/ASSETS_512x512_SquadRoyal_Tuto_CadreReady.dds";
	
	
	declare Color_HasTeam = TL::ToColor("d30000");
	declare Color_InvitationReceived = TL::ToColor("ff7f00");
	declare Color_InvitationSent = TL::ToColor("3fc2ff");
	declare Vec3 White = TL::ToColor("FFFFFF");
	declare Vec3 Black = TL::ToColor("111111");

	declare PlayersSquadML = "";
	declare PlayersListML = "";
	declare InvitationListML ="";
	declare LeadersListML = "";
	declare RequestsWhenLeaderListML = "";
	declare BuddiesListML				= "";
	declare CustomSquadOptionsML = "";
	declare PlayersPerList = 9;

	declare HorizontalArrayNumber = 0;
	
	//Squad list
	for (I, 0, 5) {
		declare PosY = (I * -9.) + 30.;
		if(I > 1){
			PosY = (I * -9.) + 30.;
		}
		if (I==0){
			PosY = 30.;
		}
			PlayersSquadML ^= """<frameinstance pos="60 {{{PosY}}}" modelid="framemodel-playersquad" />""";
	}

	for (I, 0, 3) {
		declare PosX = (I * 15.) -44.;
		declare OptionsValue = TL::ToText(4 - I);
		if(I == 3){
			PosX = 44.;
			OptionsValue = "Solo";
		}
		CustomSquadOptionsML ^= """<frame> <quad pos="{{{PosX}}} 30" z-index="0" size="12 12" scale="1." bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" hidden="0" opacity="1.0" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSET_UI_SquadRoyal_Frame_Invite.dds" id="quad-contourcustom{{{OptionsValue}}}" halign="center" valign="center"/>
		<quad pos="{{{PosX}}} 30" z-index="0" size="12 12" scale="1." bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" hidden="0" opacity="0." scriptevents="1" id="button-custom{{{OptionsValue}}}" halign="center" valign="center"/>
		<label pos="{{{PosX}}} 30" z-index="1" size="80 30" text="{{{OptionsValue}}}" textcolor="FFFFFFFF" opacity="1.0" id="label-custom{{{OptionsValue}}}" halign="center" valign="center2" textsize="4" textemboss="1" textfont="OswaldMono"/> </frame>""";
	}

	
	//Players List
	for (Array_HorizontalIndex, 0, HorizontalArrayNumber){
		declare PosXList = (Array_HorizontalIndex * 67.) - 90;
		for (Array_VerticalIndex, 0, PlayersPerList) {
			declare PosY = (Array_VerticalIndex * -6.5);
		PlayersListML ^= """<frameinstance pos="-32 {{{PosY}}}" modelid="framemodel-playerslist" />""";
		}
	}
	//Buddies List
	for (Array_HorizontalIndex, 0, HorizontalArrayNumber){
		declare PosXList = (Array_HorizontalIndex * 67.) - 90;
		for (Array_VerticalIndex, 0, PlayersPerList) {
			declare PosY = (Array_VerticalIndex * -6.5);
		BuddiesListML ^= """<frameinstance pos="-32 {{{PosY}}}" modelid="framemodel-buddieslist" />""";
		}
	}
	//Invitation List
	for (Array_HorizontalIndex, 0, HorizontalArrayNumber){
		declare PosXList = (Array_HorizontalIndex * 67.) - 90;
		for (Array_VerticalIndex, 0, 5) {
			declare PosY = (Array_VerticalIndex * -6.5);
		InvitationListML ^= """<frameinstance pos="-32 {{{PosY}}}" modelid="framemodel-invitation" />""";
		}
	}

	declare NameTextColor = <0.5, 0.5, 0.5>;
	return """
<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
	<manialink version="3" name="{{{C_Layer_TeamSelection}}}">
		<frame z-index="-1" id="background">
			<quad z-index="-148" size="330 181" valign="center" bgcolor="000000FF" opacity="0.6" id="blurscreen" pos="-161 -0.266"/>
			<quad z-index="-149" size="330 181" valign="center" bgcolor="6F6F6FFF" substyle="BgDialogBlur" bluramount="0.95" opacity="0.3" id="blurscreen" pos="-161 -0.266"/>
			<label pos="0 70" z-index="0" size="70 30" text="Royal Squad" halign="center" id="label-modename" autonewline="1" valign="center" textsize="6" textcolor="FFF" textfont="OswaldMono"/>
			<quad size="5 .5" valign="center" halign="right" bgcolor="FFF" id="ligne-title-sub" pos="23 65.5"/>
			<quad size="46 .5" valign="center" halign="center" bgcolor="FFF" id="ligne-title" pos="0 65"/>
			<label pos="0 62" z-index="0" size="70 30" text="{{{RoyalSquad_PressHToShowHelp_Text}}}" halign="center" id="label-modename" autonewline="1" valign="center" textsize="1" textcolor="FFF" textfont="OswaldMono"/>
		</frame>
		<frame id="frame-hidemenu">
			<label pos="-145 80" z-index="1" size="30 10" text="{{{RoyalSquad_HideMenu_Text}}}" textsize="2" valign="center2" halign="center" id="label-SwitchMenuDisplay" textfont="OswaldMono" textcolor="FFFFFFFF"/>
			<quad pos="-145 80" z-index="0" size="30 36" scale="1." bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" hidden="0" opacity="1.0" id="quad-contourMenuDisplay" image="{{{Img_CadreReady_V2}}}" halign="center" valign="center"/>
			<quad pos="-145 80" z-index="0" size="30 7.5" scale="1." bgcolor="1A1A1AFF" halign="center" valign="center" scriptevents="1" id="button-SwitchMenuDisplay" opacity="0.5"/>
			<label pos="-145 73" z-index="1" size="30 10" text="" textsize="1" valign="center2" halign="center" hidden="1" id="label-SwitchMenuDisplay-TeamState" textfont="OswaldMono" textcolor="FFFFFFFF"/>
		</frame>
		<frame z-index="0" id="frame-globale">
			<frame id="frame-SmallBackGround" z-index="-148" hidden="1">
				<quad z-index="0" size="200 110" valign="top" halign="center" bgcolor="000000FF" opacity="0.7" id="blursmallscreen" pos="0 45"/>
				<quad z-index="0" size="200 110" valign="top" halign="center" bgcolor="6F6F6FFF" substyle="BgDialogBlur" bluramount="0.95" opacity="0.3" id="blursmallscreen" pos="0 45"/>
				<frame id="frame-closeingame-menu" pos="0 -55" z-index="1">
					<label pos="0 0" z-index="1" size="70 30" text="{{{RoyalSquad_BackToGame_Text}}}" textsize="5" valign="center2" halign="center" id="label-backtomenu" textfont="OswaldMono" textcolor="FFFFFFFF"/>
					<quad pos="0 0" z-index="0" size="70 70" scale="1." bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" hidden="0" opacity="1.0" id="quad-contourbacktomenu" image="{{{Img_CadreReady_V2}}}" halign="center" valign="center"/>
					<quad pos="0 0" z-index="0" size="70 15" scale="1." bgcolor="1A1A1AFF" halign="center" valign="center" scriptevents="1" id="button-backtogame" opacity="0.6"/>
				</frame>
			</frame>
			<frame id="frame-PressNForMenu">
				<quad z-index="0" size="28 10" valign="top" halign="right" bgcolor="000000FF" opacity="0.4" id="blursmallscreen" pos="160 90"/>
				<quad z-index="0" size="28 10" valign="top" halign="right" bgcolor="6F6F6FFF" substyle="BgDialogBlur" bluramount="0.95" opacity="0.1" id="blursmallscreen" pos="160 90"/>
				<label z-index="1" size="15 10" valign="center" halign="right" text="{{{RoyalSquad_SquadMenu_Text}}}" textsize="2" id="label-squadmenu" pos="158 85"/>
				<frame id="frame-iconN" z-index="2">
					<label size="15 10" z-index="2" valign="center" halign="right" text="N" textsize="4" id="label-squadmenu" pos="139 85.5"/>
					<quad pos="141 85" z-index="2" valign="center" halign="right" size="8 8" bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" opacity="1.0" id="quad-contourN" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSET_UI_SquadRoyal_Frame_Invite.dds"/>
				</frame>
			</frame>
			<frame id="frame-Menu">
				<frame id="frame-teamstatus" pos="0 0">
					<label pos="60 25" z-index="1" size="15 10" text="{{{RoyalSquad_PublicTeam_Text}}}" textsize="2" valign="center2" halign="center" id="label-TeamStatus" textfont="OswaldMono" textcolor="FFFFFFFF"/>
					<quad  pos="60 25.5" z-index="4" size="50 20" halign="center" valign="center" bgcolor="11111100" opacity="1." id="quad-teamstatusbackground" />
					<quad  pos="60 25.5" z-index="0" size="50 8" valign="center" halign="center" bgcolor="111111FF" style="Bgs1" substyle="BgDialogBlur" opacity="0.8" bluramount="0.7" id="blur-teamstatusBlur"/>
					<label pos="40.5 25.5" z-index="8" size="10 10" halign="center" valign="center" text="{{{RoyalSquad_Filling_Text}}}" textsize="2" id="label-statustitle" textfont="OswaldMono" />
					<frame id="frame-changestatus" z-index="6">
						<quad pos="71 25.5" z-index="5" size="5 8" halign="center" colorize="FFFFFF" valign="center" opacity="0.3" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" rot="180" id="label-switchStatus1" textfont="OswaldMono" />
						<quad pos="71 25.5" z-index="5" size="10 10" halign="center" valign="center" id="button-switchStatus1" scriptevents="1" opacity="0." />
						<quad pos="49 25.5" z-index="5" size="10 10" halign="center" valign="center" id="button-switchStatus2" scriptevents="1" opacity="0." />
						<quad pos="49 25.5" z-index="5" size="5 8" halign="center" colorize="FFFFFF" valign="center" opacity="0.3" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" id="label-switchStatus2" textfont="OswaldMono" />
					</frame>
				</frame>
				<frame id="frame-notification" pos="0 -30" hidden="1">
					<label pos="0 0" z-index="0" size="70 30" text="NOTIFICATION" halign="center" id="label-notification" textcolor="FFFFFFFF" autonewline="1" valign="center" textsize="7" textfont="OswaldMono"/>
					<label pos="0 0" z-index="0" size="80 30" text="NOTIFICATION" halign="center" id="label-waitfornextround" textcolor="FFFFFFFF" autonewline="1" valign="center" textsize="7" textfont="OswaldMono"/>
					<label pos="0 0" z-index="0" size="25 25" text="" halign="center" valign="center2" textsize="3" textemboss="1" id="label-loadingnotif" textfont="OswaldMono" textcolor="FFFFFFFF"/>
					<quad pos="0 1" z-index="-1" size="105 35" halign="center" valign="center" bgcolor="1A1A1AFF" opacity="1."  id="quad-backgroundnotification"/>
				</frame>
				<frame id="frame-tophome">
					<label pos="0 -81" z-index="0" size="108 10" text="" halign="center" id="label-playersavailable" valign="center" textsize="2" textemboss="1" textfont="OswaldMono" textcolor="FFFFFFFF"/>
				</frame>
				<frame id="frame-autojointeam">
					<quad pos="0 10" z-index="0" size="99 106" scale="1." bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" hidden="0" opacity="1.0" id="quad-contourautojoin" image="{{{Img_CadreReady_V2}}}" halign="center" valign="center"/>
					<quad pos="0 10" z-index="0" size="99 22" scale="1." bgcolor="1A1A1AFF" halign="center" valign="center" scriptevents="1" id="button-autojoin" opacity="0.5"/>
					<label pos="0 9" z-index="1" size="80 30" scale="1.6" text="{{{RoyalSquad_STARTMATCHMAKING_Text}}}" textcolor="FFFFFFFF" opacity="1.0" halign="center" id="label-autojoin" valign="center2" textsize="6" textemboss="1" textfont="OswaldMono"/>
					<quad pos="0 10" z-index="0" size="103 130" scale="1." bgcolor="FFFA" hidden="1" opacity="1." id="quad-CallToAction" image="file://Media/ManiaLinks/Nadeo/TeamSelectionModule/ASSETS_512x512_SquadRoyal_Tuto_Ready_CallToAction.dds" halign="center" valign="center"/>
					<frame id="frame-displaycustomsquad" pos="0 1">;
						<frame id="frame-placeremaining">
							<label pos="27 -8" z-index="1" size="80 30" text="200" textcolor="FFFFFFFF" opacity="1.0" id="label-placesvalues" halign="right" valign="center2" textsize="2" textfont="OswaldMono"/>
							<label pos="50 -8" z-index="1" size="80 30" text="{{{RoyalSquad_RemainingPlaces_Text}}}" textcolor="FFFFFFFF" opacity="1.0" id="label-playersremaining" halign="right" valign="center2" textsize="2" textfont="OswaldMono"/>
						</frame>
						<frame id="frame-customsquadcheck" hidden="1">
							<label pos="-47 -6.7" z-index="10" size="5 5" opacity="1." text="X" textsize="3" hidden="1" id="label-checkcustomsquad" halign="center" valign="center"/>
							<quad pos="-47 -7" z-index="10" size="5 5" bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" opacity="1." id="quad-contour" halign="center" valign="center" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSET_UI_SquadRoyal_Frame_Invite.dds"/>
							<quad pos="-47 -7" z-index="10" size="5 5" bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" opacity="0." scriptevents="1" id="button-displaycustomsquad" halign="center" valign="center"/>
							<label pos="-31 -8" z-index="1" size="80 30" text="{{{RoyalSquad_CustomMatchMaking_Text}}}" textcolor="FFFFFFFF" opacity="1.0" id="label-customsquad" halign="center" valign="center2" textsize="2" textfont="OswaldMono"/>
						</frame>
					</frame>
					<frame id="frame-customsquad" hidden="1" pos="0 0">
						<frame id="frame-customsquadheader" pos="-49 0">
							<label pos="0 39.5" z-index="10" size="20 5" text="Players per squad" textcolor="FFFFFFFF" opacity="1.0" id="label-playerspersquad" halign="left" valign="center2" textsize="2" textfont="OswaldMono"/>
							<quad pos="0 37" z-index="-10" size="50 0.8" scale="0.8" valign="center2" halign="left" bgcolor="FFFF" id="quad-customsquadheader"/>
							<quad pos="40 37.5" z-index="-10" size="11 0.8" scale="0.8" valign="center2" halign="right" bgcolor="FFFF" id="quad-customsquadheader-sub"/>
						</frame>
						<frame id="frame-customoptions">
						{{{CustomSquadOptionsML}}}
						</frame>	
					</frame>
				</frame>
				<frame pos="-48 -40" id="frame-pager" hidden="1" opacity="0.5">
					<quad pos="0 0" z-index="0" size="5 8" scale="0.8" halign="right" valign="center" style="Icons64x64_1" substyle="ArrowDown" colorize="FFFFFF" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" scriptevents="1" id="button-page-prev"/>
					<label pos="5 0" size="20 10" scale="0.8" halign="center" valign="center2" text="0/0" class="text-default" id="label-page" textfont="OswaldMono" textcolor="FFFFFFFF"/>
					<quad pos="10 0" size="5 8" halign="right" scale="0.8" valign="center" style="Icons64x64_1" substyle="ArrowNext" scriptevents="1" colorize="FFFFFF" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" rot="180" id="button-page-next" />
				</frame>
				<frame pos="-48 -40" id="frame-buddiespager" hidden="1" opacity="0.5">
					<quad pos="0 0" z-index="0" size="5 8" scale="0.8" halign="right" valign="center" style="Icons64x64_1" substyle="BuddiesArrowDown" colorize="FFFFFF" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" rot="180" scriptevents="1" id="button-Buddiespage-prev"/>
					<label pos="5 0" size="20 10" scale="0.8" halign="center" valign="center2" text="0/0" class="text-default" id="label-Buddiespage" textfont="OswaldMono" textcolor="FFFFFFFF"/>
					<quad pos="10 0" size="5 8" scale="0.8" halign="right" valign="center" style="Icons64x64_1" substyle="ArrowNext" scriptevents="1" colorize="FFFFFF" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" rot="180" id="button-Buddiespage-next" />
				</frame>
					<frame id="frame-teamready" pos="0 10" hidden="1">
						<quad pos="0 -75" z-index="0" size="45 50" scale="2" bgcolor="FFFA" opacity="0." id="quad-autofillteamcontour" image="{{{Img_CadreReady_V2}}}" halign="center" valign="center"/>
						<quad pos="0 -75" z-index="0" size="44.5 9.6" scale="2" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button-teamready" opacity="0.5"/>
						<label pos="0 -76" z-index="25" size="25 15" scale="2" text="{{{RoyalSquad_Ready_Text}}}" textcolor="FFFFFFFF" opacity="1.0" halign="center" id="label-autofill" valign="center2" textsize="4" textfont="OswaldMono"/>
						<label pos="0 -60" z-index="25" size="35 15" scale="1.2" text="" opacity="1.0" halign="center" id="label-alert-needmates" valign="center" textsize="2" textfont="OswaldMono" textcolor="FFFFFFFF"/>
					</frame>
					<frame id="frame-leavesquad" pos="72 -59" hidden="0">
						<label pos="0 0" z-index="1" size="30 10" text="{{{RoyalSquad_LeaveTeam_Text}}}" textsize="2"  valign="center2" halign="center" id="label-leaveteam" textfont="OswaldMono" textcolor="FFFFFFFF"/>
						<quad pos="0 0" z-index="1" size="25 22"  halign="center" valign="center" opacity="1."  id="leave-squad-contour" image="{{{Img_CadreReady}}}" />
						<quad pos="0 0" z-index="1" size="24 7.5"  halign="center" valign="center" opacity="0.3" scriptevents="1" bgcolor="1A1A1AFF" id="leave-squad-button" />
					</frame>
					<frame id="frame-menu-playerslist">
						<frame id="frame-menu-buttoncreate">
							<quad pos="0 -70" z-index="0" size="52 51" scale="0.8" bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" image="{{{Img_CadreReady}}}" hidden="0" opacity="1.0" id="quad-contourCreateTeam" halign="center" valign="center"/>
							<quad pos="0 -70" z-index="0" size="50 16" scale="0.8" bgcolor="1A1A1AFF" halign="center" valign="center" scriptevents="1" id="button-playerlist" opacity="0.5"/>
							<label pos="0 -70.5" z-index="1" size="40 10"  text="{{{RoyalSquad_CreateTeam_Text}}}" textsize="4" textemboss="1" valign="center2" halign="center" id="label-Addplayer" textfont="OswaldMono"/>
							<quad pos="5 -18" z-index="2" size="23 0.5" scale="0.8" bgcolor="FFFFFFFF" valign="center" halign="center" hidden="1" id="quad-addplayerlist" opacity="0." scriptevents="1"/>
						</frame>
						<frame id="Menu-PlayerList-HeaderFooter" pos="-40 -2" hidden="1">
							<label pos="-31 40" z-index="0" size="30 10" text="{{{RoyalSquad_Invite_Text}}}" textsize="2"  valign="center2" halign="left" id="label-playerlistmenu" textfont="OswaldMono"/>
							<quad pos="-32 37" z-index="0" size="61.5 0.8" scale="0.8" valign="center2" halign="left" bgcolor="FFFF" id="QuadPlayerListTop-Small"/>
							<quad pos="-32 37" z-index="0" size="80 0.8" scale="0.8" valign="center2" halign="left" bgcolor="FFFF" opacity="0.7" id="QuadPlayerListTop-Big"/>
							<quad pos="32 37.5" z-index="0" size="4 0.8" scale="0.8" valign="center2" halign="right" bgcolor="FFFF" id="QuadPlayerListTop-sub-Players" />
							<quad pos="15.5 37.5" z-index="0" size="4 0.8" scale="0.8" valign="center2" halign="center" bgcolor="FFFF" id="QuadPlayerListTop-sub-Friends" />
							<frame id="frame-sortavailablefirst">
								<quad pos="-37 40" z-index="5" size="8 8" valign="center2" halign="center" opacity="1." image="file://Media/ManiaLinks/Nadeo/TeamSelectionModule/SortInvites.dds" id="button-sortplayerslist-img"/>
								<quad pos="-37 40" z-index="5" size="9 9" bgcolor="1A1A1AFF" valign="center2" halign="center" scriptevents="1" opacity=".3" id="button-sortplayerslist"/>
							</frame>
							<frame id="frame-ongletplayerlist">
									<quad pos="9 40" z-index="-15" size="15 5" valign="center2" halign="center"  bgcolor="6F6F6FFF" scriptevents="1" opacity="0." id="quad-buddieslist"/>
									<quad pos="9 40" z-index="-14" size="12 11" valign="center2" halign="center"  bgcolor="6F6F6FFF" id="quad-buddieslist-cadre"  opacity="0."  image="{{{Img_CadreReady}}}"/>
									<quad pos="9 40" z-index="0" size="15 5" valign="center2" halign="center"  bgcolor="ff5b00" opacity="0." scriptevents="1" id="button-buddieslist" />
									<label pos="9 40" z-index="1" size="15 5" text="{{{RoyalSquad_Friends_Text}}}" valign="center2" textsize="1" halign="center"  bgcolor="FFFA" textemboss="1" id="label-buddieslist" textfont="OswaldMono"/>
									<label pos="9 45" z-index="1" size="30 5" text="" valign="center2" textsize="2" halign="center" hidden="1"  bgcolor="FFFA" id="label-nobuddies" textfont="OswaldMono"/>
									<quad pos="24 40" z-index="0" size="15 5" valign="center2" halign="center"  bgcolor="6F6F6FFF" scriptevents="1" opacity="0." id="button-playerslist" />
									<quad pos="24 40" z-index="-15" size="15 5" valign="center2" halign="center"  bgcolor="6F6F6FFF" scriptevents="1" id="quadonglet-playerslist" />
									<quad pos="24 40" z-index="-14" size="12 11" valign="center2" halign="center" bgcolor="6F6F6FFF" id="quadonglet-playerslist-cadre" image="{{{Img_CadreReady}}}"/>
									<label pos="24 40" z-index="1" size="15 5" text="{{{RoyalSquad_Players_Text}}}" valign="center2" textsize="1" halign="center"  bgcolor="FFFA" textemboss="1" id="label-playerslist" textfont="OswaldMono"/>
							</frame>
							<frame id="Menu-PlayerList-Footer">
								<quad pos="0 -32" z-index="0" size="80 0.8" valign="center2" halign="center" scale="0.8" bgcolor="FFFF" id="QuadPlayerListBottom"/>
								<quad pos="99 -5" z-index="-10" size="52 6"  bgcolor="FFFA" style="Bgs1" substyle="BgColorContour" id="Quad-entrycontour" hidden="1"/>
								<entry pos="100 -6.25" z-index="0" size="50 5" textsize="2" default="Type player name..." id="playerlogin-entry" hidden="1"/>
							</frame>
						</frame>
					</frame>
					<frame id="frame-menu-invitationlist">
						<frame id="Menu-InvitationList-HeaderFooter">
							<label pos="0 -15" z-index="0" size="30 10" text="{{{RoyalSquad_Invitations_Text}}}" textsize="3" valign="center2" halign="center" id="label-invitationmenu" textfont="OswaldMono"/>
							<quad pos="0 -18" z-index="-10" size="80 0.8" scale="0.8" valign="center2" halign="center" bgcolor="FFFF" id="QuadInvitationListTop"/>
							<quad pos="32 -17.5" z-index="-10" size="11 0.8" scale="0.8" valign="center2" halign="right" bgcolor="FFFF" id="QuadInvitationListTop-sub"/>
							<frame id="Menu-InvitationList-Footer">
								<quad pos="0 -58.5" z-index="-10" size="80 0.8" valign="center2" halign="center" scale="0.8" bgcolor="FFFF" id="QuadInvitationListBottom"/>
							</frame>
						</frame>
					</frame>
			</frame>
			<framemodel id="framemodel-playersquad">
				<frame id="SquadMember">
					<label pos="0 1.5" z-index="1" size="45 8" halign="center" valign="center" text="" textsize="1.5" id="label-membername" textfont="OswaldMono"/>
					<label pos="0 -2" z-index="1" size="30 5" halign="center" valign="center" textsize="1" text="Squad Member" hidden="0" id="squadmember-hierarchy" textcolor="7E7E7EAA" textfont="OswaldMono"/>
					<quad  pos="0 0" z-index="4" size="50 20" halign="center" valign="center" bgcolor="11111100" opacity="1." id="quad-squadbackground" />
					<quad  pos="0 0" z-index="0" size="50 8" valign="center" halign="center" bgcolor="111111FF" style="Bgs1" substyle="BgDialogBlur" opacity="0.5" bluramount="0.7" id="blur-SquadBlur"/>			
				</frame>
				<frame id="frame-ChangeMatesNumberButton" hidden="1">
					<label pos="-20 -8" z-index="5" size="10 10" halign="center" valign="center" translate="yes" text="{{{RoyalSquad_Slots_Text}}}" textsize="2" id="label-Slot" textfont="OswaldMono" />
					<label pos="0 -8" z-index="5" size="25 10" halign="center" valign="center" translate="yes" text="" textsize="3" id="label-SlotValue" textfont="OswaldMono" />
					<quad  pos="0 -8" z-index="4" size="50 20" halign="center" valign="center" bgcolor="11111100" opacity="1." id="quad-teamstatusbackground" />
					<quad  pos="0 -8" z-index="0" size="50 8" valign="center" halign="center" bgcolor="111111FF" style="Bgs1" substyle="BgDialogBlur" opacity="0.8" bluramount="0.7" id="blur-teamstatusBlur"/>
					<frame id="frame-addmemberslot" hidden="1" z-index="7">
						<quad pos="11 -8" z-index="5" size="5 8" halign="center" colorize="FFFFFF" valign="center" rot="180" opacity="0.3" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" id="label-addmate" textfont="OswaldMono" />
						<quad pos="11 -7" z-index="5" size="10 10" halign="center" valign="center" id="button-addmate" scriptevents="1" opacity="0." />
					</frame>
					<frame id="frame-removememberslot" hidden="1" z-index="7">
						<quad pos="-11 -8" z-index="5" size="5 8" halign="center" colorize="FFFFFF" valign="center" opacity="0.3" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/Button_Scroll_v.dds" id="label-removemate" textfont="OswaldMono" />
						<quad pos="-11 -7" z-index="5" size="10 10" halign="center" valign="center" id="button-removemate" scriptevents="1" opacity="0." />
					</frame>
				</frame>
			</framemodel>
			<framemodel id="framemodel-invitation">
				<frame pos="0">
					<quad z-index="0" size="64 6" valign="center" style="Bgs1" substyle="BgDialogBlur" opacity="0.1" bluramount="0.1"  pos="0 0"/>
					<quad z-index="1" size="64 6" valign="center" bgcolor="000F" opacity="1." hidden="1" id="quad-RequesterOver" />
					<quad z-index="1" size="64 6" valign="center" bgcolor="111111FF" bgcolorfocus="1A1A1AFF" opacity="0.3" id="button-requester" scriptevents="1"  pos="0 0"/>
					<quad pos="3 0" z-index="6" size="4 4" halign="center" valign="center" bgcolor="FFFA" opacity=".5" image="file://Media/Manialinks/Nadeo/TeamSelectionModule/InvitationReceived.dds" hidden="1" id="quad-requestimg"/>
					<label pos="8 0" z-index="3" size="37 6" textsize="1.5" valign="center2" class="text-default" id="label-requester" textcolor="7E7E7EFF" halign="left" textfont="OswaldMono"/>
					<label pos="55 0" z-index="7" size="15 6" halign="center" valign="center2" textemboss="0" textcolor="FFFF" hidden="1" text="{{{RoyalSquad_ClickToAccept_Text}}}" textsize="1.3" id="label-clicktoaccept" textfont="OswaldMono"/>
					<quad pos="4 -2" z-index="5" size="80 0.5" id="quad-underline" />
				</frame>
			</framemodel>
			<frame id="frame-squadmembers" pos="0 -25" hidden="1">
				{{{PlayersSquadML}}}
			</frame>
			<frame id="headerfooter-mainsquad">
				<quad pos="60 35" z-index="-10" size="60 0.8" valign="center2" halign="center" scale="0.8" bgcolor="FFFF" id="QuadMateListTop"/>
				<quad pos="84 35.5" z-index="-10" size="5 0.8" valign="center2" halign="right" scale="0.8" bgcolor="FFFF" id="QuadMateListTop-sub"/>
				<quad pos="60 -32.5" z-index="-10" size="60 0.8" valign="center2" halign="center" scale="0.8" bgcolor="FFFF" id="QuadMateListBottom"/>
				<quad pos="84 -32" z-index="-10" size="5 0.8" valign="center2" halign="right" scale="0.8" bgcolor="FFFF" id="QuadMateListBottom-sub"/>
				<label pos="37 39" z-index="3" size="60 6" textsize="1.5" text="{{{RoyalSquad_YourTeam_Text}}}" valign="center" halign="left" class="text-default" id="label-yourteamheader" textfont="OswaldMono"/>
			</frame>
			<frame id="frame-list-players" pos="-40 30" hidden="1">
				{{{PlayersListML}}}
			</frame>			
			<frame id="frame-buddies-list" pos="-40 30" hidden="1">
				{{{BuddiesListML}}}
			</frame>
			<frame id="frame-list-invitation" pos="0 -22" hidden="1">
				{{{InvitationListML}}}
			</frame>
			<framemodel id="framemodel-playerslist">
				<quad z-index="0" size="64 6" valign="center" style="Bgs1" substyle="BgDialogBlur" opacity="0." bluramount="0.7" id="blur-OnOver"/>
				<quad z-index="1" size="64 6" valign="center" bgcolor="000F" opacity="0.2" hidden="1" id="quad-OnOver"/>
				<quad z-index="4" size="64 6" hidden="1" valign="center" bgcolor="d7a5a5" opacity="0.3" scriptevents="1" id="quad-playerinteam" />
				<label pos="55 0" z-index="4" size="15 6" halign="center" valign="center2" textemboss="0" textcolor="7E7E7EFF" text="{{{RoyalSquad_InATeam_Text}}}" textsize="1" id="label-inateam" textfont="OswaldMono"/>
				<label pos="55 0" z-index="7" size="15 6" halign="center" valign="center2" textemboss="0" textcolor="FFFF" hidden="1" text="{{{RoyalSquad_ClickToInvite_Text}}}" textsize="1.3" id="label-clicktoinvite" textfont="OswaldMono"/>
				<quad z-index="5" size="64 6" valign="center" bgcolor="111111FF" opacity="0.3" scriptevents="1" id="button-player" />
				<label pos="4 0" z-index="6" size="40 6" valign="center2"  textsize="2" id="label-name" opacity="0.8" textcolor="FFFFFFFFFF"  textfont="OswaldMono"/>
				<quad pos="-5 0" z-index="6" halign="center" valign="center" size="6 6" opacity="1." image="file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSET_UI_SquadRoyal_Frame_Invite.dds" scriptevents="1" id="quad-invitecontour" />
				<quad pos="-5 0" z-index="6" halign="center" valign="center" size="4 4" bgcolor="FFFA" opacity="1." image="file://Media/Manialinks/Nadeo/TeamSelectionModule/InvitationSent.dds" hidden="1" id="quad-playerselected"/>
			</framemodel>
			<framemodel id="framemodel-buddieslist">
				<quad z-index="0" size="64 6" valign="center" style="Bgs1" substyle="BgDialogBlur" opacity="0." bluramount="0.7" id="blur-buddyOnOver"/>
				<quad z-index="1" size="64 6" valign="center" bgcolor="000F" opacity="0.2" hidden="1" id="quad-buddyOnOver"/>
				<quad z-index="4" size="64 6" hidden="1" valign="center" bgcolor="d7a5a5" opacity="0.3" id="quad-buddyplayerinteam" />
				<quad z-index="7" size="64 6" valign="center" bgcolor="111111FF" opacity="0.3" scriptevents="1" id="button-buddies" />
				<label pos="4 0" z-index="8" size="40 6" valign="center2"  textsize="2" id="label-buddyname" opacity="0.8" textcolor="FFFFFFFFFF"  textfont="OswaldMono"/>
				<quad pos="-5 0" z-index="6" halign="center" valign="center" size="6 6" opacity="1." image="file://Media/Manialinks/Nadeo/TeamSelectionModule/ASSET_UI_SquadRoyal_Frame_Invite.dds" scriptevents="1" id="quad-buddyinvitecontour" />
				<quad pos="-5 0" z-index="6" halign="center" valign="center" size="4 4" bgcolor="FFFA" opacity="1." image="file://Media/Manialinks/Nadeo/TeamSelectionModule/InvitationSent.dds" hidden="1" id="quad-buddyplayerselected"/>
			</framemodel>
		</frame>
		
		<script><!--

#Include "TextLib" as TL
#Include "MathLib" as ML
#Include "ColorLib" as CL
#Include "AnimLib" as AL

declare Integer G_PlacesAvailable;
declare Integer G_RefreshUITime;
declare Integer G_PlayersAvailable;
declare Boolean G_IsMouseOver_AutoJoin;
declare Boolean G_IsMouseOver_CreateTeam;
declare Boolean G_IsMouseOver_TeamReady;
declare Boolean G_IsMouseOver_LeaveTeam;
declare Boolean G_SortInTeamPlayersLast;
declare Real G_X;
declare Real G_OpacitySentQuad;
declare Boolean IsSwitchDisplayOn;
declare CMlFrame G_PrevLastOngletVisible;
declare Integer G_MatesNumberSet;
declare Integer[] G_SquadOptionsCheck; 
declare Boolean G_SquadMenuAsked;
declare Boolean G_UseTeamCreation;
declare Boolean G_PrivateTeamCheck;
declare Boolean G_PublicTeamCheck;
declare Integer G_NewTeamStatusTimer;
declare Boolean G_SortPlayerClicked;
CPlayer GetOwner() {
	if (GUIPlayer != Null) return GUIPlayer;
	return InputPlayer;
}

// Return the CPlayer associate to the Id
CPlayer GetPlayerFromId (Ident _PlayerId) {
	foreach (Player in Players){
		if (Player.Id == _PlayerId) {
			return Player;
		}
	}
	return Null;
}

CPlayer GetPlayerFromLogin (Text _PlayerName) {
	foreach(Player in Players){
		if (Player.User.Login == _PlayerName) {
			return Player;
		}
	}
	return Null;
}

Ident GetIdFromName(Text _Login){
	foreach(Player in Players){
		if (Player.User.Name == _Login){
			return Player.Id;
		}
	}
	return NullId;
}

Ident GetIdFromLogin(Text _Login){
	foreach(Player in Players){
		if (Player.User.Login == _Login){
			return Player.Id;
		}
	}
	return NullId;
}

Text GetLoginFromId(Ident _Id){
	foreach(Player in Players){
		if(Player.Id == _Id){
			return Player.User.Login;
		}
	}
	return "";
}

Text GetNameFromLogin(Text _Login){
	foreach(Player in Players){
		if(Player.User.Login == _Login){
			return Player.User.Name;
		}
	}
	return "";
}

Text GetLoginFromName(Text _Name){
	foreach(Player in Players){
		if(Player.User.Name == _Name){
			return Player.User.Login;
		}
	}
	return "";
}
// Return the CPlayer associate to the name
CPlayer GetPlayerFromName (Text _PlayerName) {
	foreach(Player in Players){
		if (Player.User.Login == _PlayerName) {
			
			return Player;
		}
	}
	return Null;
}

CPlayer GetPlayerFromUserName(Text _PlayerName){
	foreach(Player in Players){
		if(Player.User.Name == _PlayerName){
			return Player;
		}
	}
	return Null;
}

Integer UpdatePager(CMlFrame _Frame_Pager, Integer _ItemsPerPage, Integer _ItemsCount, Integer _CurrentPage, Boolean _IsClicked, Boolean _Frame_PlayersList_Visible) {
	if (_ItemsPerPage <= 0) return 1;

	// Find page max
	declare PageMax = _ItemsCount / _ItemsPerPage;
	if (_ItemsCount % _ItemsPerPage != 0) PageMax += 1;

	declare CurrentPage = _CurrentPage;
	if (CurrentPage < 1) CurrentPage = 1;
	if (CurrentPage > PageMax) CurrentPage = PageMax;
	// Update pager UI
	if (_Frame_Pager != Null) {
		if (PageMax <= 1 || _Frame_PlayersList_Visible == False) {
			_Frame_Pager.Visible = False;
		}
		else if((PageMax > 1 && _Frame_PlayersList_Visible == True) || _Frame_PlayersList_Visible == True) {
			_Frame_Pager.Visible = True;
			declare Label_Page <=> (_Frame_Pager.GetFirstChild("label-page") as CMlLabel);
			declare Button_PagePrev <=> (_Frame_Pager.GetFirstChild("button-page-prev") as CMlQuad);
			declare Button_PageNext <=> (_Frame_Pager.GetFirstChild("button-page-next") as CMlQuad);
			Label_Page.Value = CurrentPage^"/"^PageMax;
			if (CurrentPage <= 1) {
				Button_PagePrev.Substyle = "ArrowDisabled";
			
				Button_PagePrev.Visible = False;
			} else {
				Button_PagePrev.Substyle = "ArrowPrev";
				Button_PagePrev.Opacity = 0.3;
				Button_PagePrev.Visible = True;
			}
		if (CurrentPage >= PageMax) {
				Button_PageNext.Substyle = "ArrowDisabled";
				Button_PageNext.Visible = False;
			}
			else {
				Button_PageNext.Substyle = "ArrowNext";
				Button_PageNext.Opacity = 0.3;
				Button_PageNext.Visible = True;
			}
			
		}
	}

	return CurrentPage;
}

Integer UpdateBuddiesPager(CMlFrame _Frame_Pager, Integer _ItemsPerPage, Integer _ItemsCount, Integer _CurrentPage, Boolean _IsClicked) {
	if (_ItemsPerPage <= 0) return 1;
	// Find page max
	declare PageMax = _ItemsCount / _ItemsPerPage;
	if (_ItemsCount % _ItemsPerPage != 0) PageMax += 1;
	declare CurrentPage = _CurrentPage;
	if (CurrentPage < 1) CurrentPage = 1;
	if (CurrentPage > PageMax) CurrentPage = PageMax;
	// Update pager UI
	if (_Frame_Pager != Null) {
		if (PageMax <= 1) {
			_Frame_Pager.Visible = False;
		}
		else {
			declare Label_Page <=> (_Frame_Pager.GetFirstChild("label-Buddiespage") as CMlLabel);
			declare Button_PagePrev <=> (_Frame_Pager.GetFirstChild("button-Buddiespage-prev") as CMlQuad);
			declare Button_PageNext <=> (_Frame_Pager.GetFirstChild("button-Buddiespage-next") as CMlQuad);
			Label_Page.Value = CurrentPage^"/"^PageMax;
			if (CurrentPage <= 1) {
				Button_PagePrev.Substyle = "ArrowDisabled";
			} else {
				Button_PagePrev.Substyle = "ArrowPrev";
			}
		if (CurrentPage >= PageMax) {
				Button_PageNext.Substyle = "ArrowDisabled";
			}
			else {
				Button_PageNext.Substyle = "ArrowNext";
			}
		}
	}
	return CurrentPage;
}

Void SetLabelSizeToTextWidth(CMlLabel _LabelToResize){
	_LabelToResize.Size.X = _LabelToResize.ComputeWidth(_LabelToResize.Value);	

}

Void AdaptFrameMateNumbersPositionByMates(Integer _FrameIndex, CMlFrame _Frame_MateNumbers){	
	_Frame_MateNumbers.RelativePosition_V3.Y = 20. + (_FrameIndex*9.);
}

Void UpdateSquadMembers(
	CMlFrame _Frame_SquadMembers,
	Text[] _SquadMembers,
	Boolean _IsPlayersUpdated,
	Boolean _IsMouseOver,
	Integer _Net_S_PlayersPerTeam,
	Text	_LocalUserLogin,
	Boolean _IsInAutoFill,
	Boolean _IsInAutoJoin,
	Boolean _IsTeamReady,
	Boolean _IsLeader,
	Boolean _IsPrivateSquad
) {
	foreach(FrameIndex => Control in _Frame_SquadMembers.Controls) {
		declare Frame_Member <=> (Control as CMlFrame);
		declare Label_MemberName <=> (Frame_Member.GetFirstChild("label-membername") as CMlLabel);
		declare Label_Hierarchy <=> (Frame_Member.GetFirstChild("squadmember-hierarchy") as CMlLabel);
		declare Quad_ProfilePicture <=> (Frame_Member.GetFirstChild("squadmember-picture") as CMlQuad);
		declare Quad_ProfilePictureContour <=> (Frame_Member.GetFirstChild("squadmember-picturecontour") as CMlQuad);
		declare Frame_ChangeMateNumber <=> (Frame_Member.GetFirstChild("frame-ChangeMatesNumberButton") as CMlFrame);
		declare Label_AddMemberSlot <=> (Frame_Member.GetFirstChild("label-addmate") as CMlQuad);
		declare Quad_Button_AddMemberSlot <=> (Frame_Member.GetFirstChild("button-addmate") as CMlQuad);
		declare Quad_Button_RemoveMemberSlot <=> (Frame_Member.GetFirstChild("button-removemate") as CMlQuad);
		declare Label_RemoveMemberSlot <=> (Frame_Member.GetFirstChild("label-removemate") as CMlQuad);
		declare Label_SlotValue <=> (Frame_Member.GetFirstChild("label-SlotValue") as CMlLabel);
		declare Quad_Button_SwitchStatus1 <=> (Page.GetFirstChild("button-switchStatus1") as CMlQuad);
		declare Quad_Button_SwitchStatus2 <=> (Page.GetFirstChild("button-switchStatus2") as CMlQuad);
		declare Label_SwitchStatus1 <=> (Page.GetFirstChild("label-switchStatus1") as CMlQuad);
		declare Label_SwitchStatus2 <=> (Page.GetFirstChild("label-switchStatus2") as CMlQuad);
		Label_MemberName.Value = "";
		if(!_IsPrivateSquad){
			Label_SlotValue.Value = TL::ToText(G_MatesNumberSet);
		} else Label_SlotValue.Value = "From 1 to "^_Net_S_PlayersPerTeam^" Players";
		
		AdaptFrameMateNumbersPositionByMates(FrameIndex, Frame_ChangeMateNumber);

		Quad_Button_SwitchStatus2.Visible = True;
		Quad_Button_SwitchStatus1.Visible = True;
		if (_Net_S_PlayersPerTeam > 0) {
			if(_SquadMembers.count == 0 || _SquadMembers.count == 1){
				if (FrameIndex == 0) {
					Label_Hierarchy.Value = "";
					Label_MemberName.TextSizeReal = 3.;	
					declare MemberName = LocalUser.Name;
					if (MemberName != "") {
						Label_MemberName.Value = MemberName;
					}			
				} else {
					Label_MemberName.Value = "";
					Label_Hierarchy.TextColor = <0.8, 0.8, 0.8>;
					Label_Hierarchy.Value = "";
					Label_Hierarchy.Value ="";
				}
			}
			if (_SquadMembers.existskey(FrameIndex) && FrameIndex < _Net_S_PlayersPerTeam && _SquadMembers.count >= 1 && FrameIndex < G_MatesNumberSet) {
				if (FrameIndex == 0) {
					Label_Hierarchy.Value = "";
					Label_MemberName.TextSizeReal = 3.;				
				} 
				else {
					Label_Hierarchy.Value = "";
					Label_Hierarchy.TextColor = <0.8, 0.8, 0.8>;
					Label_MemberName.TextColor = <1., 1., 1.>;
					Label_MemberName.TextSizeReal = 2.2;
				}
				declare NewMember = _SquadMembers[FrameIndex];
				declare MemberName = GetNameFromLogin(NewMember);
				if (NewMember != "") {
					Quad_Button_RemoveMemberSlot.Visible = False;
					Label_RemoveMemberSlot.Opacity = 0.;
					Label_MemberName.Value = MemberName;
					if(FrameIndex < G_MatesNumberSet - 1){
						Frame_ChangeMateNumber.Visible = False;
						Quad_Button_AddMemberSlot.Visible = False;
						Label_AddMemberSlot.Opacity = 0.;
						Quad_Button_RemoveMemberSlot.Visible = False;
						Label_RemoveMemberSlot.Opacity = 0.;
					} else if (FrameIndex == G_MatesNumberSet - 1){
						Frame_ChangeMateNumber.Visible = True;
						if(Label_MemberName.Value == "{{{RoyalSquad_EmptySlot_Text}}} "^FrameIndex+1){
							Quad_Button_AddMemberSlot.Visible = True;
							Label_AddMemberSlot.Opacity = 0.3;
							Quad_Button_RemoveMemberSlot.Visible = True;
							Label_RemoveMemberSlot.Opacity = 0.3;
						} else {
							Quad_Button_AddMemberSlot.Visible = True;
							Label_AddMemberSlot.Opacity = 0.3;
							Quad_Button_RemoveMemberSlot.Visible = False;
							Label_RemoveMemberSlot.Opacity = 0.;
						}
						if(FrameIndex == _Net_S_PlayersPerTeam - 1){
							Quad_Button_AddMemberSlot.Visible = False;
							Label_AddMemberSlot.Opacity = 0.;
						}
					}
				}
			}
			else {
				if (_Frame_SquadMembers.Controls.count > _Net_S_PlayersPerTeam - 1){
				//Si la frameindex est supérieure à _Net_S_PlayersPerTeam
					if(FrameIndex > _Net_S_PlayersPerTeam - 1){
						Frame_Member.Visible = False;
					} else {
						Frame_Member.Visible = True;
						if(Label_MemberName.Value == ""){
							Label_MemberName.Value = "{{{RoyalSquad_EmptySlot_Text}}} "^FrameIndex+1;
							Label_MemberName.TextSizeReal = 1.2;	
							Label_Hierarchy.TextColor = <0.8, 0.8, 0.8>;
							Label_Hierarchy.Value = "";
							Label_Hierarchy.Value ="";
							if(FrameIndex < G_MatesNumberSet - 1){
								Frame_ChangeMateNumber.Visible = False;
								Quad_Button_AddMemberSlot.Visible = False;
								Label_AddMemberSlot.Opacity = 0.;
								Quad_Button_RemoveMemberSlot.Visible = False;
								Label_RemoveMemberSlot.Opacity = 0.;
							} else if (FrameIndex == G_MatesNumberSet - 1){
								Frame_ChangeMateNumber.Visible = True;
								if(Label_MemberName.Value == "{{{RoyalSquad_EmptySlot_Text}}} "^FrameIndex+1){
									Quad_Button_AddMemberSlot.Visible = True;
									Label_AddMemberSlot.Opacity = 0.3;
									Quad_Button_RemoveMemberSlot.Visible = True;
									Label_RemoveMemberSlot.Opacity = 0.3;
								} else {
									Quad_Button_AddMemberSlot.Visible = True;
									Label_AddMemberSlot.Opacity = 0.3;
									Quad_Button_RemoveMemberSlot.Visible = False;
									Label_RemoveMemberSlot.Opacity = 0.;
								}
								if(FrameIndex == _Net_S_PlayersPerTeam - 1){
									Label_AddMemberSlot.Opacity = 0.;
									Quad_Button_AddMemberSlot.Visible = False;
								}
							} else if (FrameIndex > G_MatesNumberSet - 1){
								Frame_Member.Visible = False;
							}
						}
					} 
				}
			}
		}
		//Check si il y'a plus de Frame apparu que de Frame possible par team
		if(_IsInAutoFill || _IsInAutoJoin || _IsTeamReady || !_IsLeader && _SquadMembers.count > 1){
			Label_AddMemberSlot.Opacity = 0.;
			Quad_Button_AddMemberSlot.Visible = False;
			Quad_Button_RemoveMemberSlot.Visible = False;
			Label_RemoveMemberSlot.Opacity = 0.;
			Label_SwitchStatus1.Opacity = 0.;
			Label_SwitchStatus2.Opacity = 0.;
			Quad_Button_SwitchStatus2.Visible = False;
			Quad_Button_SwitchStatus1.Visible = False;
		} 
		if(_IsPrivateSquad){
			Label_AddMemberSlot.Opacity = 0.;
			Quad_Button_AddMemberSlot.Visible = False;
			Quad_Button_RemoveMemberSlot.Visible = False;
			Label_RemoveMemberSlot.Opacity = 0.;
		}
	}
	
}
CSmPlayer GetCSmPlayerFromLogin(Text _PlayerName){
	foreach(Player in Players){
		if (Player.User.Login == _PlayerName) {
			
			return Player;
		}
	}
	return Null;
}

Void UpdateInvitationList (
	CMlFrame _Frame_ListInvitation,
	Text[] _RequesterNames) {
	declare Text[] NewRequesterNames;	
	NewRequesterNames = _RequesterNames;
	foreach(FrameIndex => Control in _Frame_ListInvitation.Controls) {
		declare Frame_Requester <=> (Control as CMlFrame);
		declare Label_RequesterName <=> (Frame_Requester.GetFirstChild("label-requester") as CMlLabel);
		declare Image_RequestImg <=> (Frame_Requester.GetFirstChild("quad-requestimg") as CMlQuad);
		
		if (NewRequesterNames.existskey(FrameIndex)) {
			declare NewRequester = NewRequesterNames[FrameIndex];
			declare NewRequesterName = GetNameFromLogin(NewRequester);
			Frame_Requester.Visible = True;
			Image_RequestImg.Visible = True;
			Label_RequesterName.Value = NewRequesterName;
		}
		else if(!NewRequesterNames.existskey(FrameIndex)) {
			Frame_Requester.Visible = False;
			Label_RequesterName.Value = "";
			Image_RequestImg.Visible = False;
		}	
	}
}
Void PlayersAvailable(Integer _PlayersInGame, Integer _PlayersInTeam){
	G_PlayersAvailable = _PlayersInGame - _PlayersInTeam;
	if(G_PlayersAvailable < 0){
		G_PlayersAvailable = 0;
	}
}
declare CMlFrame	G_Frame_Globale;
declare CMlFrame	G_Frame_Pager;
declare CMlFrame	G_Frame_ListPlayers;
declare CMlFrame	G_Frame_ListInvitation;
declare CMlFrame	G_Frame_SquadMembers;
declare CMlQuad		G_Quad_LeaveSquad;
declare CMlQuad		G_Quad_LeaveTeamContour;
declare CMlLabel	G_Label_InvitationMenu;
declare CMlFrame	G_Frame_Menu;
declare CMlLabel  G_Label_SwitchDisplay;
declare CMlLabel	G_Label_SwitchDisplay_TeamState;
declare CMlQuad		G_Quad_ButtonPrivateTeam;
declare CMlQuad		G_Quad_ButtonPublicTeam;
declare CMlFrame	G_Frame_Menu_Invitation;
declare CMlFrame	G_Frame_Menu_PlayerListButton;
declare CMlFrame	G_Frame_Menu_PlayerListHeaderFooter;
declare CMlLabel 	G_Label_PlayersAvailable;
declare CMlQuad		G_Quad_ContourCreateTeam;
declare CMlFrame	G_Frame_AutoFillTeam;
declare CMlQuad		G_Button_AutoFillTeam;
declare CMlFrame	G_Frame_HomeMenu;
declare CMlFrame	G_Frame_HideMenu;
declare CMlQuad		G_Quad_PublicTeam_Background;
declare CMlQuad		G_Quad_PrivateTeam_Background;
declare CMlLabel	G_Label_PublicTeam;
declare CMlFrame	G_Frame_Autojoin;
declare CMlLabel	G_Label_HomeMenu;
declare CMlLabel	G_Label_AutoJoin;
declare CMlQuad		G_Button_AutoJoin;
declare CMlFrame 	G_MenuBackGround;
declare CMlQuad 	G_Quad_ContourAutoJoin;
declare CMlEntry 	G_Label_MateSearched;
declare CMlLabel 	G_Label_AutoFill;
declare CMlLabel 	G_Label_AlertNeedMates;
declare CMlQuad		G_Quad_ContourAutoFill;
declare CMlFrame	G_Frame_MenuTop;
declare CMlFrame	G_HeaderMainSquad;
declare CMlFrame	G_Frame_TeamStatus;
declare CMlFrame G_Frame_CustomSquad;
declare CMlFrame G_Frame_LeaveSquadButton;
declare CMlFrame G_Frame_Notification;
declare CMlLabel G_Label_Notification;
declare CMlLabel G_Label_Notif_WaitForNextRound;
declare CMlLabel G_Label_PlacesAvailable;
declare CMlFrame G_Frame_BuddiesList;
declare CMlFrame G_Frame_BuddiesPager;
declare CMlFrame G_Frame_PlacesAvailable;
declare CMlQuad G_Button_BuddiesList;
declare CMlQuad G_Quad_BuddiesList;
declare CMlQuad G_Quad_BuddiesListCadre;
declare CMlQuad G_Quad_Onglet_PlayersList;
declare CMlQuad G_Quad_Onglet_PlayersListCadre;
declare CMlLabel G_Label_BuddiesOnglet;
declare CMlLabel G_Label_PlayersOnglet;
declare CMlLabel G_Label_NoBuddies_Notif;
declare CMlQuad Label_SwitchStatus1;
declare CMlQuad Label_SwitchStatus2;
declare CMlQuad G_Quad_Notifiation;
declare CMlLabel G_Label_LoadingNotification;
declare CMlQuad G_Quad_InvitationBottom;
declare CMlQuad Quad_Button_SwitchStatus2;
declare CMlQuad Quad_Button_SwitchStatus1;
declare CMlQuad G_Button_SortPlayersList;
declare CMlQuad G_Quad_TopLineInvitationList_Big;
declare CMlQuad G_Quad_TopLineInvitationList_SubFriends;
declare CMlQuad G_Quad_TopLineInvitationList_SubPlayers;
declare CMlQuad G_Quad_Ready_CallToAction;
declare CMlQuad G_Button_DisplayCustomSquad;
declare CMlFrame G_Frame_CustomSquadOptions;
declare CMlFrame G_Frame_SmallBackGround;
declare CMlFrame G_Frame_PressSquadButtonIcon;
declare Text[] BuddiesInServer;
declare Ident[] PlayerList;
Void UpdateBuddiesList(CMlFrame _Frame_ListBuddies, Text[] _BuddiesList, Ident[] _PlayersList, Integer _Page, Text[] _BuddiesSelected, Ident[] _AllPlayersInTeam, Text[] _TeamMates){
	declare netread Text[] Net_PlayersWithNoTeam for Teams[0];
	BuddiesInServer = _BuddiesList;
	foreach(Buddy in BuddiesInServer){
		declare IdOfBuddy = GetIdFromLogin(Buddy);
		if(!_PlayersList.exists(IdOfBuddy)){
			BuddiesInServer.remove(Buddy);
		}
	}
	declare KeyShift = (_Page - 1) * _Frame_ListBuddies.Controls.count;
	foreach(FrameIndex => Control in _Frame_ListBuddies.Controls){
		declare Frame_Buddy <=> (Control as CMlFrame);
		declare Label_BuddyName <=> (Frame_Buddy.GetFirstChild("label-buddyname") as CMlLabel);
		declare Button_Buddy <=> (Frame_Buddy.GetFirstChild("button-buddies") as CMlQuad); 
		declare Quad_BuddyUnderline <=> (Frame_Buddy.GetFirstChild("quad-buddyplayerselected") as CMlQuad);
		declare Quad_OnOver <=> (Frame_Buddy.GetFirstChild("quad-buddyOnOver") as CMlQuad);
		declare Quad_PlayerInTeam <=> (Frame_Buddy.GetFirstChild("quad-buddyplayerinteam") as CMlQuad);
		declare Quad_BuddyInviteContour <=> (Frame_Buddy.GetFirstChild("quad-buddyinvitecontour") as CMlQuad);
		declare Ident[] IdsOfPlayersInTeam;
		foreach(PlayerInTeam in _AllPlayersInTeam){
			if(!IdsOfPlayersInTeam.exists(PlayerInTeam)){
				IdsOfPlayersInTeam.add(PlayerInTeam);
			}
		}
		if (BuddiesInServer.existskey(FrameIndex + KeyShift)){
			declare BuddyPlayer <=> GetPlayerFromLogin(BuddiesInServer[KeyShift + FrameIndex]);
			declare netwrite Net_SelectedPlayer for UI = "";
			declare Text LoginOfPlayer;
			
			Frame_Buddy.Visible = True;
			Quad_PlayerInTeam.Show();
			if(!_AllPlayersInTeam.exists(BuddyPlayer.Id)){
				Frame_Buddy.Visible = True;
				Button_Buddy.Show();
				Quad_PlayerInTeam.Hide();
				if (BuddyPlayer.User.Login != "") {
					Label_BuddyName.Value = BuddyPlayer.User.Name;
					Quad_BuddyInviteContour.Show();
				}	
				//Feedback of invited players
				if(_BuddiesSelected.exists(BuddyPlayer.User.Login)){
					Quad_BuddyUnderline.Visible = True;
				}
				else if (!_BuddiesSelected.exists(BuddyPlayer.User.Login)){
					Quad_BuddyUnderline.Visible = False;
				} 
				if(Quad_BuddyUnderline.Visible == True){
					G_OpacitySentQuad = Now * 0.003;
					Quad_BuddyUnderline.Opacity = ML::Abs(ML::Sin(G_OpacitySentQuad))/1.5 + 0.3;
				}
				declare TeamSelection_Login for Button_Buddy = "";
				TeamSelection_Login = BuddyPlayer.User.Login;
				Net_SelectedPlayer = TeamSelection_Login;
			}
			else if(_AllPlayersInTeam.exists(BuddyPlayer.Id)) {
				
				if(_TeamMates.exists(BuddyPlayer.User.Login)){
				Quad_PlayerInTeam.BgColor =	<0., 0., 0.8>;
				} else Quad_PlayerInTeam.BgColor =	<0.8, 0., 0.>;
				Label_BuddyName.Value = BuddyPlayer.User.Name;
				Button_Buddy.Hide();
				Quad_OnOver.Hide();
				Quad_BuddyInviteContour.Hide();
				Quad_PlayerInTeam.Show();
				Quad_BuddyUnderline.Visible = False;
				Quad_BuddyUnderline.Visible = False;
			}
				
		} else {
			Frame_Buddy.Visible = False;
		}
	}
}
Void UpdatePlayerList(
CMlFrame _Frame_ListPlayers,
Ident[] _PlayerIds,
Integer _Page,
Text[] _PlayerSelected,
Ident[] _AllPlayersInTeam,
Text _PlayerSearched,
Boolean _G_SortInTeamPlayersLast,
Text[] _TeamMates) {
	declare netread Text[] Net_PlayersWithNoTeam for Teams[0];
	declare KeyShift = (_Page - 1) * _Frame_ListPlayers.Controls.count;
	foreach (FrameIndex => Control in _Frame_ListPlayers.Controls) {
		declare Frame_Player <=> (Control as CMlFrame);
		declare Label_Name <=> (Frame_Player.GetFirstChild("label-name") as CMlLabel);
		declare Button_Player <=> (Frame_Player.GetFirstChild("button-player") as CMlQuad); 
		declare Quad_Underline <=> (Frame_Player.GetFirstChild("quad-playerselected") as CMlQuad);
		declare Quad_OnOver <=> (Frame_Player.GetFirstChild("quad-OnOver") as CMlQuad);
		declare Quad_PlayerInTeam <=> (Frame_Player.GetFirstChild("quad-playerinteam") as CMlQuad);
		declare Label_InATeam <=> (Frame_Player.GetFirstChild("label-inateam") as CMlLabel);
		declare Quad_InviteContour <=> (Frame_Player.GetFirstChild("quad-invitecontour") as CMlQuad);
		declare Ident[] IdsOfPlayersInTeam;
		PlayersAvailable(_PlayerIds.count, _AllPlayersInTeam.count);
		foreach(PlayerInTeam in _AllPlayersInTeam){
			if(!IdsOfPlayersInTeam.exists(PlayerInTeam)){
				if(_G_SortInTeamPlayersLast){
					PlayerList.remove(PlayerInTeam);
				}
				IdsOfPlayersInTeam.add(PlayerInTeam);
			}
		}
		if(_G_SortInTeamPlayersLast){
			foreach(IdInTeam in IdsOfPlayersInTeam){
				declare PlayerOfId <=> GetPlayerFromId(IdInTeam);
				if(PlayerOfId != Null){
					if(!PlayerList.exists(IdInTeam) && PlayerOfId.User.Login != LocalUser.Login ){
						PlayerList.add(IdInTeam);
					}
				}
			}
		}
		if (PlayerList.existskey(FrameIndex + KeyShift) && Players.existskey(PlayerList[FrameIndex + KeyShift])){
			declare PlayerFromId <=> GetPlayerFromId(PlayerList[FrameIndex + KeyShift]);
			declare Text LoginOfPlayer;
			if(PlayerFromId != Null){
				LoginOfPlayer = PlayerFromId.User.Login;
			}
			declare netwrite Net_SelectedPlayer for UI = "";
			
			Frame_Player.Visible = True;
		
			if(PlayerFromId != Null){
				if(!_AllPlayersInTeam.exists(PlayerFromId.Id)){
					Button_Player.Show();
					Quad_PlayerInTeam.Hide();
					Label_InATeam.Hide();
					Quad_InviteContour.Show();
					if (PlayerFromId != Null) {
						Label_Name.Value = PlayerFromId.User.Name;
					}	
					//Feedback of invited players
						if(_PlayerSelected.exists(LoginOfPlayer)){
							Quad_Underline.Visible = True;
						}
						else if (!_PlayerSelected.exists(LoginOfPlayer)){
							Quad_Underline.Visible = False;
						}
					declare TeamSelection_Login for Button_Player = "";
					TeamSelection_Login = PlayerFromId.User.Login;
					Net_SelectedPlayer = TeamSelection_Login;
				}
				else if(IdsOfPlayersInTeam.exists(PlayerList[FrameIndex + KeyShift])) {
					Label_Name.Value = PlayerFromId.User.Name;
					Quad_InviteContour.Hide();
					Button_Player.Hide();
					Quad_OnOver.Hide();
					Quad_PlayerInTeam.Show();
					Label_InATeam.Value = "{{{RoyalSquad_InATeam_Text}}}";
					if(_TeamMates.exists(PlayerFromId.User.Login)){
						Quad_PlayerInTeam.BgColor = <0., 0., 0.8>;
						Label_InATeam.Value = "{{{RoyalSquad_InYourTeam_Text}}}";
					} else Quad_PlayerInTeam.BgColor = <0.8, 0., 0.>;
					Label_InATeam.Show();
					Quad_Underline.Visible = False;
				}
			}
			
			
		}
		else {
			Frame_Player.Visible = False;
		}
	}
	//The player search a name
	G_SortInTeamPlayersLast = False;
}
Void InitTeamUI() {
	G_Frame_Globale <=> (Page.GetFirstChild("frame-globale") as CMlFrame);
	G_Frame_HideMenu <=> (Page.GetFirstChild("frame-hidemenu") as CMlFrame);
	G_Frame_TeamStatus	<=> (Page.GetFirstChild("frame-teamstatus") as CMlFrame);
	G_Frame_Pager <=> (G_Frame_Globale.GetFirstChild("frame-pager") as CMlFrame);
	G_Frame_BuddiesPager <=> (G_Frame_Globale.GetFirstChild("frame-buddiespager") as CMlFrame);
	G_Frame_ListPlayers <=> (G_Frame_Globale.GetFirstChild("frame-list-players") as CMlFrame);
	G_Frame_BuddiesList <=> (G_Frame_Globale.GetFirstChild("frame-buddies-list") as CMlFrame);
	G_Frame_ListInvitation <=> (G_Frame_Globale.GetFirstChild("frame-list-invitation") as CMlFrame);
	G_Frame_SquadMembers <=> (G_Frame_Globale.GetFirstChild("frame-squadmembers") as CMlFrame);
	G_Label_PlayersAvailable <=> (G_Frame_Globale.GetFirstChild("label-playersavailable") as CMlLabel);
	G_Quad_ContourAutoJoin <=> (G_Frame_Globale.GetFirstChild("quad-contourautojoin") as CMlQuad);
	G_Quad_ContourCreateTeam <=> (G_Frame_Globale.GetFirstChild("quad-contourCreateTeam") as CMlQuad);
	G_Label_MateSearched <=> (G_Frame_Globale.GetFirstChild("playerlogin-entry") as CMlEntry);
	G_Label_AutoFill <=> (G_Frame_Globale.GetFirstChild("label-autofill") as CMlLabel);
	G_Label_AlertNeedMates <=> (G_Frame_Globale.GetFirstChild("label-alert-needmates") as CMlLabel);
	G_Quad_ContourAutoFill <=> (G_Frame_Globale.GetFirstChild("quad-autofillteamcontour") as CMlQuad);
	G_HeaderMainSquad <=> (G_Frame_Globale.GetFirstChild("headerfooter-mainsquad") as CMlFrame);
	G_Button_BuddiesList <=> (G_Frame_Globale.GetFirstChild("button-buddieslist") as CMlQuad);
	G_Quad_BuddiesList <=> (G_Frame_Globale.GetFirstChild("quad-buddieslist") as CMlQuad);
	G_Quad_BuddiesListCadre <=> (G_Frame_Globale.GetFirstChild("quad-buddieslist-cadre") as CMlQuad);
	G_Quad_Onglet_PlayersList <=> (G_Frame_Globale.GetFirstChild("quadonglet-playerslist") as CMlQuad);
	G_Quad_Onglet_PlayersListCadre <=> (G_Frame_Globale.GetFirstChild("quadonglet-playerslist-cadre") as CMlQuad);
	G_Label_BuddiesOnglet <=> (G_Frame_Globale.GetFirstChild("label-buddieslist") as CMlLabel);
	G_Label_PlayersOnglet <=> (G_Frame_Globale.GetFirstChild("label-playerslist") as CMlLabel);
	G_Label_NoBuddies_Notif <=> (G_Frame_Globale.GetFirstChild("label-nobuddies") as CMlLabel);
	G_Quad_InvitationBottom <=> (G_Frame_Globale.GetFirstChild("QuadInvitationListBottom") as CMlQuad);
	G_Label_InvitationMenu <=> (G_Frame_Globale.GetFirstChild("label-invitationmenu") as CMlLabel);
	G_Frame_Menu <=> (G_Frame_Globale.GetFirstChild("frame-Menu") as CMlFrame);
	G_Frame_Notification <=> (G_Frame_Globale.GetFirstChild("frame-notification") as CMlFrame);
	G_Label_Notification <=> (G_Frame_Globale.GetFirstChild("label-notification") as CMlLabel);
	G_Label_PlacesAvailable <=> (G_Frame_Globale.GetFirstChild("label-placesvalues") as CMlLabel);
	G_Frame_PlacesAvailable <=> (G_Frame_Globale.GetFirstChild("frame-placeremaining") as CMlFrame);
	G_Label_Notif_WaitForNextRound <=> (G_Frame_Globale.GetFirstChild("label-waitfornextround") as CMlLabel);
	G_Quad_Notifiation <=> (G_Frame_Globale.GetFirstChild("quad-backgroundnotification") as CMlQuad);
	G_Label_LoadingNotification <=> (G_Frame_Globale.GetFirstChild("label-loadingnotif") as CMlLabel);
	G_Quad_LeaveSquad <=> (G_Frame_Globale.GetFirstChild("leave-squad-button") as CMlQuad);
	G_Quad_LeaveTeamContour <=> (G_Frame_Globale.GetFirstChild("leave-squad-contour") as CMlQuad);
	G_Frame_LeaveSquadButton <=> (G_Frame_Globale.GetFirstChild("frame-leavesquad") as CMlFrame);
	G_Label_SwitchDisplay <=> (G_Frame_HideMenu.GetFirstChild("label-SwitchMenuDisplay") as CMlLabel);
	G_Label_SwitchDisplay_TeamState <=> (G_Frame_HideMenu.GetFirstChild("label-SwitchMenuDisplay-TeamState") as CMlLabel);
	G_Frame_Menu_Invitation <=> (G_Frame_Menu.GetFirstChild("frame-menu-invitationlist") as CMlFrame);
	G_Frame_Menu_PlayerListButton <=> (G_Frame_Menu.GetFirstChild("frame-menu-playerslist") as CMlFrame);
	G_Frame_Menu_PlayerListHeaderFooter <=> (G_Frame_Menu_PlayerListButton.GetFirstChild("Menu-PlayerList-HeaderFooter") as CMlFrame);
	G_Frame_MenuTop <=> (G_Frame_Globale.GetFirstChild("frame-tophome") as CMlFrame);
	G_Frame_AutoFillTeam <=> (G_Frame_Globale.GetFirstChild("frame-teamready") as CMlFrame);
	G_Button_AutoFillTeam <=> (G_Frame_AutoFillTeam.GetFirstChild("button-teamready") as CMlQuad);
	G_Frame_HomeMenu <=> (G_Frame_Globale.GetFirstChild("frame-menu-buttoncreate") as CMlFrame);
	G_Frame_Autojoin <=> (G_Frame_Globale.GetFirstChild("frame-autojointeam") as CMlFrame);
	G_Label_HomeMenu <=> (G_Frame_Globale.GetFirstChild("label-Addplayer") as CMlLabel);
	G_Label_AutoJoin <=> (G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
	G_Button_AutoJoin <=> (G_Frame_Globale.GetFirstChild("button-autojoin") as CMlQuad);
	G_MenuBackGround <=> (Page.GetFirstChild("background") as CMlFrame);
	G_Button_SortPlayersList <=> (G_Frame_Globale.GetFirstChild("button-sortplayerslist") as CMlQuad);
	G_Quad_TopLineInvitationList_Big <=> (G_Frame_Globale.GetFirstChild("QuadPlayerListTop-Big") as CMlQuad);
	G_Quad_TopLineInvitationList_SubFriends <=> (G_Frame_Globale.GetFirstChild("QuadPlayerListTop-sub-Friends") as CMlQuad);
	G_Quad_TopLineInvitationList_SubPlayers <=> (G_Frame_Globale.GetFirstChild("QuadPlayerListTop-sub-Players") as CMlQuad);
	G_Quad_Ready_CallToAction <=> (G_Frame_Globale.GetFirstChild("quad-CallToAction") as CMlQuad);
	G_Frame_CustomSquad <=> (G_Frame_Globale.GetFirstChild("frame-customsquad") as CMlFrame);
	Label_SwitchStatus1 <=> (G_Frame_Globale.GetFirstChild("label-switchStatus1") as CMlQuad);
	Label_SwitchStatus2 <=> (G_Frame_Globale.GetFirstChild("label-switchStatus2") as CMlQuad);
	Quad_Button_SwitchStatus1 <=> (G_Frame_Globale.GetFirstChild("button-switchStatus1") as CMlQuad);
	Quad_Button_SwitchStatus2 <=> (G_Frame_Globale.GetFirstChild("button-switchStatus2") as CMlQuad);
	G_Button_DisplayCustomSquad <=> (G_Frame_Globale.GetFirstChild("button-displaycustomsquad") as CMlQuad);
	G_Frame_CustomSquadOptions <=> (G_Frame_Globale.GetFirstChild("frame-customoptions") as CMlFrame);
	G_Frame_SmallBackGround <=> (G_Frame_Globale.GetFirstChild("frame-SmallBackGround") as CMlFrame);
	G_Frame_PressSquadButtonIcon <=> (G_Frame_Globale.GetFirstChild("frame-PressNForMenu") as CMlFrame);
}

Void HandleUI_SelectionOnBuddies(Boolean _IsBuddiesList, Text[] _BuddiesInServer) {
	if(_IsBuddiesList) {
		G_Quad_BuddiesList.Opacity	= 1.;
		G_Quad_BuddiesList.Size.Y = 6.;
		G_Quad_BuddiesList.Size.X = 16.;
		G_Quad_Onglet_PlayersList.Size.Y = 3.5;
		G_Quad_Onglet_PlayersList.Size.X = 11.5;
		G_Label_BuddiesOnglet.TextSizeReal = 2.;
		G_Label_PlayersOnglet.TextSizeReal = 1.;
		G_Quad_BuddiesListCadre.Opacity = 0.;
		G_Quad_Onglet_PlayersList.Opacity = 0.3;	
		G_Quad_TopLineInvitationList_Big.Opacity = 0.7;
		G_Quad_TopLineInvitationList_SubPlayers.Opacity  = 0.;
		G_Quad_TopLineInvitationList_SubFriends.Opacity = 1.;
		
	} else {
		G_Quad_BuddiesList.Opacity	= 0.3;
		G_Quad_BuddiesList.Size.Y = 3.5;
		G_Quad_BuddiesList.Size.X = 11.5;
		G_Quad_Onglet_PlayersList.Opacity = 1.;
		G_Quad_Onglet_PlayersList.Size.Y = 6.;
		G_Quad_Onglet_PlayersList.Size.X = 16.;
		G_Label_BuddiesOnglet.TextSizeReal = 1.;
		G_Label_PlayersOnglet.TextSizeReal = 2.;
		if(_BuddiesInServer.count > 0){
			G_Quad_BuddiesList.Opacity = 0.3;
			G_Quad_BuddiesListCadre.Opacity = 1.;
		} else {
			G_Quad_BuddiesList.Opacity = 0.;
			G_Quad_BuddiesListCadre.Opacity = 0.;
		}
		G_Quad_Onglet_PlayersListCadre.Opacity = 0.;
		G_Quad_TopLineInvitationList_Big.Opacity = 1.;
		G_Quad_TopLineInvitationList_SubPlayers.Opacity  = 1.;
		G_Quad_TopLineInvitationList_SubFriends.Opacity = 0.;
	}
}

Boolean HasJustArrived(Boolean _IsMember, Boolean _IsLeader, Boolean _IsInAutoJoin, Boolean _IsSpawned, Boolean _IsPlayerSpectate) {
	return !_IsMember && !_IsLeader && !_IsInAutoJoin && !_IsSpawned && !_IsPlayerSpectate;
}

Void UI_DisplaySquadOptions(Boolean _DisplayOptions){
	declare Frame_CustomSquadCount = 4;
	declare CMlQuad Button_Option;
	foreach(Control in G_Frame_CustomSquadOptions.Controls){
		if(Frame_CustomSquadCount > 1){
			Button_Option <=> (G_Frame_CustomSquadOptions.GetFirstChild("button-custom"^Frame_CustomSquadCount) as CMlQuad);
		} else Button_Option <=> (G_Frame_CustomSquadOptions.GetFirstChild("button-customSolo") as CMlQuad);
		Frame_CustomSquadCount -= 1;
		if(Button_Option != Null && _DisplayOptions){
			Button_Option.Visible = True;
		} else if (Button_Option != Null && !_DisplayOptions){
			Button_Option.Visible = False;
		}
	}
}

Void LoadHomeMenu() {
	G_Frame_Menu.Visible = True;
	if(!IsSwitchDisplayOn){
		G_MenuBackGround.Visible 					= False;
		G_Frame_Globale.Visible 					= False;
	} else {
		G_MenuBackGround.Visible 					= True;
		G_Frame_Globale.Visible 					= True;
	}
	if(G_SquadOptionsCheck.exists(1)){
		G_Label_AutoJoin.Value = "{{{RoyalSquad_Ready_Text}}}";
	} else G_Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
	G_PublicTeamCheck = True;
	G_PrivateTeamCheck = False;
	G_NewTeamStatusTimer = Now;
	G_Label_AutoFill.Value = "{{{RoyalSquad_Ready_Text}}}";
	G_UseTeamCreation = False;
	EnableMenuNavigation(False, False, Null, 1);
	G_Frame_SmallBackGround.Visible	  = False;
	G_Frame_PressSquadButtonIcon.Visible = False;
	Label_SwitchStatus1.Opacity = 0.;
	Label_SwitchStatus2.Opacity = 0.;
	Quad_Button_SwitchStatus2.Visible = False;
	Quad_Button_SwitchStatus1.Visible = False;
	G_Button_DisplayCustomSquad.Visible = False;
	UI_DisplaySquadOptions(True);
	G_Frame_PlacesAvailable.Visible							= True;
	G_Frame_TeamStatus.Visible									= False;
	G_Frame_Menu_PlayerListButton.Visible 			= True;
	G_Frame_SquadMembers.Visible 								= False;
	G_Frame_ListInvitation.Visible 							= True;
	G_Frame_HomeMenu.Visible 										= True;
	G_Frame_Autojoin.Visible 										= True;
	G_Frame_AutoFillTeam.Visible 								= False;
	G_Frame_ListPlayers.Visible 								= False;
	G_Frame_BuddiesList.Visible									= False;
	G_Label_AutoJoin.Visible 										= True;
	G_Label_AlertNeedMates.Visible 							= False;
	G_Label_HomeMenu.Value 											= "{{{RoyalSquad_CreateTeam_Text}}}";
	G_Frame_Menu_Invitation.Visible 						= True;
	G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
	G_Button_AutoJoin.Visible 									= True;
	G_Label_PlayersAvailable.Visible						= True;
	G_Frame_LeaveSquadButton.Visible						= False;
	G_Frame_MenuTop.Visible											= True;
	G_HeaderMainSquad.Visible										= False;
	G_Quad_ContourAutoJoin.Visible							= True;
	G_Frame_Notification.Visible								= False;
	G_Frame_Pager.Visible												=	False;
	G_Frame_HideMenu.Visible										= True;
	G_Label_SwitchDisplay.Value									= "{{{RoyalSquad_HideMenu_Text}}}";
	G_Label_SwitchDisplay_TeamState.Value 			= "{{{RoyalSquad_NoTeam_Text}}}";
	G_Label_SwitchDisplay_TeamState.Visible			= False;
	IsSwitchDisplayOn 													= True;
	G_RefreshUITime = Now;
}

Boolean IsInAutoJoin(Boolean _IsInAutoJoin, Boolean _IsSpectating, Boolean _IsMember, Boolean _IsSpawned) {
	return _IsInAutoJoin && !_IsSpectating && !_IsMember && !_IsSpawned;
}

Void LoadAutoJoinMenu() {
	if(!IsSwitchDisplayOn){
		G_MenuBackGround.Visible 					= False;
		G_Frame_Globale.Visible 					= False;
	} else {
		G_MenuBackGround.Visible 					= True;
		G_Frame_Globale.Visible 					= True;
	}
	G_UseTeamCreation = False;
	EnableMenuNavigation(False, False, Null, 1);
	G_Frame_SmallBackGround.Visible	  = False;
	G_Frame_PressSquadButtonIcon.Visible = False;
	G_Button_DisplayCustomSquad.Visible = False;
	Label_SwitchStatus1.Opacity = 0.;
	Label_SwitchStatus2.Opacity = 0.;
	Quad_Button_SwitchStatus2.Visible = False;
	Quad_Button_SwitchStatus1.Visible = False;
	UI_DisplaySquadOptions(False);
	G_Frame_TeamStatus.Visible									= True;
	G_Frame_LeaveSquadButton.Visible						= False;
	G_Frame_HideMenu.Visible										= True;	
	G_Frame_Globale.Visible 										= True;
	G_Frame_Autojoin.Visible										= True;
	G_Frame_HomeMenu.Visible 										= False;
	G_Frame_ListInvitation.Visible 							= False;
	G_Frame_SquadMembers.Visible 								= False;
	G_Frame_ListPlayers.Visible 								= False;
	G_Frame_BuddiesList.Visible									= False;
	G_Frame_Menu_PlayerListButton.Visible				= False;
	G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
	G_Frame_Menu_Invitation.Visible 						= False;
	G_Frame_AutoFillTeam.Visible 								= False;
	G_Frame_Pager.Visible												= False;
	G_Frame_BuddiesPager.Visible								= False;
	G_Label_PlayersAvailable.Visible						= True;
	G_Frame_MenuTop.Visible											= True;
	G_HeaderMainSquad.Visible										= False;
	G_Frame_Notification.Visible								= True;
	G_Frame_TeamStatus.Visible									= False;
	G_Frame_Notification.RelativePosition_V3.Y	= -25.;
	G_Frame_Notification.RelativePosition_V3.X	= 0.;
	G_Quad_Notifiation.Size.X									= 101.;
	G_Quad_Notifiation.Size.Y									= 23.;
	G_Label_LoadingNotification.Visible				= True;
	G_Label_Notification.Value									= "{{{RoyalSquad_SearchingForTeam_Text}}}";
	G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_SearchingForPlayers_Text}}}";
	G_Label_Notification.TextSizeReal			= 9.;
	G_Label_Notification.RelativePosition_V3.Y	= 0.;
	G_Label_Notification.RelativePosition_V3.X	= -7.;
	G_Label_Notif_WaitForNextRound.Value			= "";
	G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -32.;
	G_Label_LoadingNotification.RelativePosition_V3.X	= 40.;
	G_Label_LoadingNotification.RelativePosition_V3.Y	= 0.5;
	G_Label_LoadingNotification.TextSizeReal = 9.;
	G_Label_AutoJoin.Value 											= "{{{RoyalSquad_Cancel_Text}}}";
	G_RefreshUITime = Now;
	G_PublicTeamCheck = True;
	G_PrivateTeamCheck = False;
	G_NewTeamStatusTimer = Now;
}

Boolean IsANonLeaderWaiting(Boolean _IsMember, Boolean _IsLeader, Boolean _IsSpawned, Boolean _IsInAutoJoin, Boolean _IsSpectating, Boolean _InATeamForMode) {
	return _IsMember && !_IsLeader && !_IsSpawned && !_IsInAutoJoin && !_IsSpectating && !_InATeamForMode;
}

Void LoadWaitingTeamOnly() {
	if(!IsSwitchDisplayOn){
		G_MenuBackGround.Visible 				= False;
		G_Frame_Globale.Visible 				= False;
	} else {
		G_MenuBackGround.Visible 				= True;
		G_Frame_Globale.Visible 				= True;
	}
	G_PublicTeamCheck = True;
	G_PrivateTeamCheck = False;
	G_NewTeamStatusTimer = Now;
	EnableMenuNavigation(False, False, Null, 1);
	G_Frame_SmallBackGround.Visible	  = False;
	G_Frame_PressSquadButtonIcon.Visible = False;
	Label_SwitchStatus1.Opacity = 0.;
	Label_SwitchStatus2.Opacity = 0.;
	Quad_Button_SwitchStatus2.Visible = False;
	Quad_Button_SwitchStatus1.Visible = False;
	G_Frame_TeamStatus.Visible				= True;
	G_Frame_Pager.Visible		 					= False;
	G_Frame_BuddiesPager.Visible			= False;
	G_Frame_ListPlayers.Visible		 		= False;
	G_Frame_BuddiesList.Visible				= False;
	G_Frame_Autojoin.Visible 			  	= False;
	G_Frame_Menu_Invitation.Visible 	= False;
	G_Frame_HomeMenu.Visible 			 	  = False;
	G_Frame_ListInvitation.Visible 		= False;
	G_Label_PlayersAvailable.Visible	= True;
	G_Frame_LeaveSquadButton.Visible 	= True;
	G_Frame_MenuTop.Visible						= False;
	G_Frame_Notification.Visible			= True;
	G_Label_Notif_WaitForNextRound.Value			= "";
	G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -30.;
	G_Label_Notification.Value				= "{{{RoyalSquad_WaitingForTeamToComplete_Text}}}";
	G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_SearchingForPlayers_Text}}}";
	G_Frame_Notification.RelativePosition_V3.Y	= 0.;
	G_Frame_Notification.RelativePosition_V3.X	= -45.;
	G_Quad_Notifiation.Size.X									= 80.;
	G_Quad_Notifiation.Size.Y									= 70.;
	G_Label_Notification.TextSizeReal			= 11.;
	G_Label_Notification.RelativePosition_V3.Y	= 10.;
	G_Label_Notification.RelativePosition_V3.X	= 0.;
	G_Label_LoadingNotification.Visible = True;
	G_Label_LoadingNotification.RelativePosition_V3.Y	= -19.;
	G_Label_LoadingNotification.RelativePosition_V3.X	= 0.;
	G_Label_LoadingNotification.TextSizeReal = 15.;
	G_Label_LoadingNotification.RelativeRotation -= 0.1;
	G_Label_AlertNeedMates.Visible 							= False;
	G_Frame_HideMenu.Visible										= True;
	G_Frame_Menu_PlayerListButton.Visible				= False;
	

	G_Frame_PlacesAvailable.Visible							= False;
	G_Frame_SquadMembers.Visible 	 		= True;
	G_HeaderMainSquad.Visible					= True;
	G_Frame_Menu.Visible 							= True;
	G_RefreshUITime 									= Now;
}

Boolean IsALeaderWaiting(Boolean _IsMember, Boolean _IsLeader, Boolean _InATeamForMode, Boolean _IsSpawned, Boolean _IsInAutoJoin, Boolean _IsSpectating) {
	return _IsMember && _IsLeader && !_InATeamForMode && !_IsSpawned && !_IsInAutoJoin && !_IsSpectating;
}

Void UpdateNotificationFrame(Boolean _IsTeamFull, Boolean _IsInAutoFill, Boolean _IsSpawned){
	if(_IsTeamFull){
		G_Frame_Notification.Visible							= True;
		G_Label_Notification.Value								= "{{{RoyalSquad_TeamIsComplete_Text}}}";
		G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_TeamIsComplete_Text}}}";
		if(!_IsSpawned){
			G_Label_Notif_WaitForNextRound.Value			= "{{{RoyalSquad_WaitForNextRound_Text}}}";
		} else G_Label_Notif_WaitForNextRound.Value			= "";
		G_Frame_Notification.RelativePosition_V3.Y = 0.;
		G_Label_Notification.TextSizeReal							= 10.;
		G_Label_Notification.RelativePosition_V3.Y	= 8.;
		G_Label_Notification.RelativePosition_V3.X	= 0.;
		G_Frame_Notification.RelativePosition_V3.X	= -45.;
		G_Quad_Notifiation.Size.X									= 80.;
		G_Quad_Notifiation.Size.Y									= 70.;
		G_Label_LoadingNotification.Visible 				= False;
		G_Label_LoadingNotification.RelativePosition_V3.Y	= 15.;
		G_Label_LoadingNotification.RelativePosition_V3.X	= 0.;
		G_Label_LoadingNotification.TextSizeReal = 17.;
		G_Label_LoadingNotification.RelativeRotation -= 0.1;
		G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -10.;
		if(G_MatesNumberSet == 1){
			G_Label_Notification.Value = "{{{RoyalSquad_TeamSolo_Text}}}";
			G_Frame_TeamStatus.Visible = False;
		}
	}
	else if (_IsInAutoFill && !_IsTeamFull){
		G_Label_Notif_WaitForNextRound.Value			= "";
		G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -10.;
		G_Label_Notification.Value				= "{{{RoyalSquad_WaitingForTeamToComplete_Text}}}";
		G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_SearchingForPlayers_Text}}}";
		G_Frame_Notification.RelativePosition_V3.Y	= 0.;
		G_Frame_Notification.RelativePosition_V3.X	= -45.;
		G_Quad_Notifiation.Size.X									= 80.;
		G_Quad_Notifiation.Size.Y									= 70.;
		G_Label_Notification.TextSizeReal			= 11.;
		G_Label_Notification.RelativePosition_V3.Y	= 10.;
		G_Label_Notification.RelativePosition_V3.X	= 0.;
		G_Label_LoadingNotification.Visible = True;
		G_Label_LoadingNotification.RelativePosition_V3.Y	= -19.;
		G_Label_LoadingNotification.RelativePosition_V3.X	= 0.;
		G_Label_LoadingNotification.TextSizeReal = 15.;
		G_Label_LoadingNotification.RelativeRotation -= 0.1;
	}
}

Void DebugLog(
	Boolean _IsMember,
	Boolean _IsLeader, 
	Boolean _InATeamForMode, 
	Boolean _IsSpawned, 
	Boolean _AskForMenu, 
	Boolean _IsInAutoJoin,
	Boolean _IsSpectating,
	Boolean _IsInAutoFill,
	Boolean _TeamIsFull) {
	//log("MEMBER "^_IsMember^" | IsLeader "^_IsLeader^" | IsInAutoFill "^_IsInAutoFill^" | TeamIsFull "^_TeamIsFull^" | _IsInAutoJoin "^_IsInAutoJoin);
}

Void LoadTeamUI(Boolean _IsMember, Boolean _IsLeader, Boolean _InATeamForMode, Boolean _IsSpawned, Boolean _AskForMenu, Boolean _IsInAutoJoin,	Boolean _IsSpectating,	Boolean _IsInAutoFill,	Boolean _TeamIsFull, Boolean _IsTeamReady){
	DebugLog(_IsMember, _IsLeader, _InATeamForMode, _IsSpawned, _AskForMenu, _IsInAutoJoin, _IsSpectating, _IsInAutoFill, _TeamIsFull);
	if(HasJustArrived(_IsMember, _IsLeader, _IsInAutoJoin, _IsSpawned, _IsSpectating)){
		LoadHomeMenu();
	} else if (IsInAutoJoin(_IsInAutoJoin, _IsSpectating, _IsMember, _IsSpawned)) {
		LoadAutoJoinMenu();
	} else if (IsANonLeaderWaiting(_IsMember, _IsLeader, _IsSpawned, _IsInAutoJoin, _IsSpectating, _TeamIsFull)) {
		LoadWaitingTeamOnly();
	} else if (_IsLeader && _IsInAutoFill && !_IsSpawned && !_IsSpectating && !_TeamIsFull){
		if(!IsSwitchDisplayOn){
			G_MenuBackGround.Visible 					= False;
			G_Frame_Globale.Visible 					= False;
		} else {
			G_MenuBackGround.Visible 					= True;
			G_Frame_Globale.Visible 					= True;
		}
		Label_SwitchStatus1.Opacity = 0.;
		Label_SwitchStatus2.Opacity = 0.;
		Quad_Button_SwitchStatus2.Visible = False;
		Quad_Button_SwitchStatus1.Visible = False;
		G_Frame_PlacesAvailable.Visible		= False;
		G_Frame_TeamStatus.Visible				= True;
		G_Frame_HideMenu.Visible 					= True;
		G_Frame_Pager.Visible		 					= False;
		G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
		G_Frame_BuddiesPager.Visible			= False;
		G_Frame_ListPlayers.Visible		 		= False;
		G_Frame_BuddiesList.Visible				= False;
		G_Frame_Autojoin.Visible 			  	= False;
		G_Frame_Menu_Invitation.Visible 	= False;
		G_Frame_HomeMenu.Visible 			 	  = False;
		G_Frame_ListInvitation.Visible 		= False;
		G_Label_AlertNeedMates.Visible 		= False;
		G_Label_PlayersAvailable.Visible	= True;
		G_Frame_MenuTop.Visible						= False;
		G_Frame_Notification.Visible			= True;
		G_Frame_LeaveSquadButton.Visible	= True;
		G_Label_Notification.Value				= "{{{RoyalSquad_WaitingForTeamToComplete_Text}}}";
		G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_SearchingForPlayers_Text}}}";
		G_Label_Notification.TextSizeReal			= 11.;
		G_Label_Notification.RelativePosition_V3.Y	= 10.;
		G_Label_Notification.RelativePosition_V3.X	= 0.;
		G_Label_Notif_WaitForNextRound.Value			= "";
		G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -30.;
		G_Frame_Menu_PlayerListButton.Visible				= False;
		G_Frame_Notification.RelativePosition_V3.X	= -45.;
		G_Frame_Notification.RelativePosition_V3.Y = 0.;
		G_Quad_Notifiation.Size.X									= 80.;
		G_Quad_Notifiation.Size.Y									= 70.;
		G_Label_LoadingNotification.Visible = True;
		G_Label_LoadingNotification.RelativePosition_V3.Y	= -19.;
		G_Label_LoadingNotification.RelativePosition_V3.X	= 0.;
		G_Label_LoadingNotification.TextSizeReal = 15.;
		G_Label_LoadingNotification.RelativeRotation -= 0.1;
		G_Frame_SquadMembers.Visible 	 		= True;
		G_MenuBackGround.Visible 					= True;
		G_HeaderMainSquad.Visible					= True;
		G_Frame_Menu.Visible 							= True;
		G_RefreshUITime 									= Now;
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = False;
		EnableMenuNavigation(False, False, Null, 1);
		if(!_IsInAutoJoin){
			G_Frame_AutoFillTeam.Visible 	= True;
			G_Button_AutoFillTeam.Visible = True;
			G_Label_AutoFill.Value = "{{{RoyalSquad_Cancel_Text}}}";
		}
	} else if (_IsLeader && _IsInAutoFill && !_IsSpawned && !_IsSpectating && _TeamIsFull){
		if(!IsSwitchDisplayOn){
			G_MenuBackGround.Visible 					= False;
		} else {
			G_MenuBackGround.Visible 					= True;
		}
		Label_SwitchStatus1.Opacity = 0.;
		Label_SwitchStatus2.Opacity = 0.;
		Quad_Button_SwitchStatus2.Visible = False;
		Quad_Button_SwitchStatus1.Visible = False;
		G_Frame_PlacesAvailable.Visible						= False;
		G_Frame_TeamStatus.Visible								= True;
		G_Frame_HideMenu.Visible									= True;
		G_Frame_Pager.Hide();
		G_Frame_ListPlayers.Visible		 						= False;
		G_Frame_BuddiesList.Visible								= False;
		if(G_UseTeamCreation){
			G_Frame_AutoFillTeam.Visible = True;
		}
		G_Frame_HomeMenu.Visible 			 						= False;
		G_Frame_Autojoin.Visible 			 						= False;
		G_Frame_ListInvitation.Visible 						= False;
		G_Label_PlayersAvailable.Visible					= True;
		G_Frame_LeaveSquadButton.Visible					= True;
		G_Frame_Menu_PlayerListButton.Visible			= False;
		G_Frame_Menu.Visible 											= True;
		G_Frame_MenuTop.Visible										= False;
		G_HeaderMainSquad.Visible									= True;
		G_Frame_SquadMembers.Visible							= True;
		G_Frame_Notification.Visible							= True;
		G_Label_Notification.Value								= "{{{RoyalSquad_TeamIsComplete_Text}}}";
		G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_TeamIsComplete_Text}}}";
		G_Frame_Notification.RelativePosition_V3.Y = 0.;
		G_Label_Notification.TextSizeReal			= 10.;
		G_Label_Notification.RelativePosition_V3.Y	= 8.;
		G_Label_Notification.RelativePosition_V3.X	= 0.;
		G_Frame_Notification.RelativePosition_V3.X	= -45.;
		G_Label_Notif_WaitForNextRound.Value			= "{{{RoyalSquad_WaitForNextRound_Text}}}";
		G_Label_Notif_WaitForNextRound.TextSizeReal			= 7.;
		G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -7.;
		G_Frame_Notification.RelativePosition_V3.X	= -45.;
		G_Quad_Notifiation.Size.X									= 80.;
		G_Quad_Notifiation.Size.Y									= 70.;
		G_Label_LoadingNotification.Visible				= False;
		G_Label_LoadingNotification.RelativePosition_V3.Y	= 15.;
		G_Label_LoadingNotification.RelativePosition_V3.X	= 0.;
		G_Label_LoadingNotification.TextSizeReal = 15.;
		G_Label_LoadingNotification.RelativeRotation -= 0.1;
		
		G_Frame_Menu_Invitation.Visible 						= False;
		G_Label_AlertNeedMates.Visible 							= False;
		G_RefreshUITime = Now;
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = False;
		EnableMenuNavigation(False, False, Null, 1);
		if(G_MatesNumberSet == 1){
			G_Label_Notification.Value = "{{{RoyalSquad_TeamSolo_Text}}}";
			G_Frame_TeamStatus.Visible = False;
		}
	} else if(_IsMember && _IsInAutoJoin && !_IsSpawned && !_IsSpectating){
		if(!IsSwitchDisplayOn){
			G_MenuBackGround.Visible 					= False;
			G_Frame_Globale.Visible 					= False;
		} else {
			G_MenuBackGround.Visible 					= True;
			G_Frame_Globale.Visible 					= True;
		}
		Label_SwitchStatus1.Opacity = 0.;
		Label_SwitchStatus2.Opacity = 0.;
		Quad_Button_SwitchStatus2.Visible = False;
		Quad_Button_SwitchStatus1.Visible = False;
		G_Frame_PlacesAvailable.Visible			= False;
		G_Frame_TeamStatus.Visible					= True;
		G_Frame_HideMenu.Visible = True;
		G_Frame_Pager.Visible		 					= False;
		G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
		G_Frame_BuddiesPager.Visible			= False;
		G_Frame_ListPlayers.Visible		 		= False;
		G_Frame_BuddiesList.Visible				= False;
		G_Frame_Autojoin.Visible 			  	= False;
		G_Frame_Menu_Invitation.Visible 	= False;
		G_Frame_HomeMenu.Visible 			 	  = False;
		G_Frame_ListInvitation.Visible 		= False;
		G_Label_AlertNeedMates.Visible 		= False;
		G_Label_PlayersAvailable.Visible	= True;
		G_Frame_LeaveSquadButton.Visible 	= True;
		G_Frame_MenuTop.Visible						= False;
		G_Frame_Notification.Visible			= True;
		G_Label_Notification.Value				= "{{{RoyalSquad_WaitingForTeamToComplete_Text}}}";
		G_Label_SwitchDisplay_TeamState.Value			= "{{{RoyalSquad_SearchingForPlayers_Text}}}";
		G_Frame_Notification.RelativePosition_V3.Y = 0.;
		G_Label_Notification.TextSizeReal			= 10.;
		G_Label_Notification.RelativePosition_V3.Y	= 10.;
		G_Label_Notification.RelativePosition_V3.X	= 0.;
		G_Label_Notif_WaitForNextRound.Value			= "";
		G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -30.;
		G_Frame_Menu_PlayerListButton.Visible				= False;
		G_Frame_Notification.RelativePosition_V3.X	= -45.;
		G_Quad_Notifiation.Size.X									= 80.;
		G_Quad_Notifiation.Size.Y									= 70.;
		G_Label_LoadingNotification.RelativePosition_V3.Y	= -19.;
		G_Label_LoadingNotification.RelativePosition_V3.X	= 0.;
		G_Label_LoadingNotification.TextSizeReal = 15.;
		G_Label_LoadingNotification.RelativeRotation -= 0.1;
		G_Label_LoadingNotification.Visible = True;
		G_Frame_SquadMembers.Visible 	 		= True;
		G_MenuBackGround.Visible 					= True;
		G_HeaderMainSquad.Visible					= True;
		G_Frame_Menu.Visible 							= True;
		G_RefreshUITime 									= Now;
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = False;
		EnableMenuNavigation(False, False, Null, 1);
	}
	else if (IsALeaderWaiting(_IsMember, _IsLeader, _TeamIsFull, _IsSpawned, _IsInAutoJoin, _IsSpectating)){
		G_Frame_TeamStatus.Visible									= True;
		G_Frame_PlacesAvailable.Visible							= False;
		G_Frame_HideMenu.Visible										= True;
		G_Button_AutoFillTeam.Visible 							= True;
		G_Frame_AutoFillTeam.Visible 								= True;	
		G_Frame_Menu_PlayerListHeaderFooter.Visible = True;
		G_Frame_SquadMembers.Visible								= True;
		G_Frame_Menu_PlayerListButton.Visible				= True;
		G_Frame_HomeMenu.Visible 										= False;
		G_Frame_Autojoin.Visible 										= False;
		G_Frame_ListInvitation.Visible 							= False;
		G_Frame_Menu_Invitation.Visible							= False;
		G_Label_PlayersAvailable.Visible						= True;
		G_Frame_LeaveSquadButton.Visible						= True;
		G_Frame_MenuTop.Visible											= False;
		G_HeaderMainSquad.Visible										= True;
		G_Frame_Menu.Visible 												= True;
		G_Frame_Notification.Visible								= False;
		G_Label_AlertNeedMates.Visible 							= False;
		G_Label_SwitchDisplay_TeamState.Value 			= "{{{RoyalSquad_UnFullTeam_Text}}}";
		if(!_IsTeamReady){
			Label_SwitchStatus1.Opacity = 0.3;
			Label_SwitchStatus2.Opacity = 0.3;
			Quad_Button_SwitchStatus2.Visible = True;
			Quad_Button_SwitchStatus1.Visible = True;
		}
		if(G_PrevLastOngletVisible == G_Frame_BuddiesList){
			G_Frame_BuddiesList.Visible = True;
			if(BuddiesInServer.count > 0 && G_Frame_BuddiesList.Visible == True){
				HandleUI_SelectionOnBuddies(True, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= False;
				G_Frame_BuddiesList.Visible								= True;
				G_Frame_Pager.Visible											= False;
			} else if (BuddiesInServer.count == 0 && G_Frame_ListPlayers.Visible == True){
				HandleUI_SelectionOnBuddies(False, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= True;
				G_Frame_BuddiesList.Visible								= False;
			}
		} else if (G_PrevLastOngletVisible == G_Frame_ListPlayers){
				G_Frame_ListPlayers.Visible = True;
				if(BuddiesInServer.count > 0 && G_Frame_BuddiesList.Visible == True){
				HandleUI_SelectionOnBuddies(True, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= False;
				G_Frame_BuddiesList.Visible								= True;
				G_Frame_Pager.Visible											= False;
			} else if (BuddiesInServer.count == 0 && G_Frame_ListPlayers.Visible == True){
				HandleUI_SelectionOnBuddies(False, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= True;
				G_Frame_BuddiesList.Visible								= False;
			}
		}
		if(BuddiesInServer.count > 0 && G_Frame_BuddiesList.Visible == True){
			HandleUI_SelectionOnBuddies(True, BuddiesInServer);
			G_Frame_ListPlayers.Visible								= False;
			G_Frame_BuddiesList.Visible								= True;
			G_Frame_Pager.Visible											= False;
		} else if (BuddiesInServer.count == 0 && G_Frame_ListPlayers.Visible == True){
			HandleUI_SelectionOnBuddies(False, BuddiesInServer);
			G_Frame_ListPlayers.Visible								= True;
			G_Frame_BuddiesList.Visible								= False;
		}
		if(!IsSwitchDisplayOn){
			G_MenuBackGround.Visible 					= False;
			G_Frame_Globale.Visible 					= False;
		} else {
			G_MenuBackGround.Visible 					= True;
			G_Frame_Globale.Visible 					= True;
		}
		G_RefreshUITime = Now;
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = False;
		EnableMenuNavigation(False, False, Null, 1);
		UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, 1, True, G_Frame_ListPlayers.Visible);
	} else if (_IsMember && _IsLeader && _TeamIsFull && !_IsInAutoJoin && !_IsSpawned && !_IsSpectating && !_IsInAutoFill){
		if(!IsSwitchDisplayOn){
			G_MenuBackGround.Visible 					= False;
		} else {
			G_MenuBackGround.Visible 					= True;
		}
		if(_IsTeamReady){
			Label_SwitchStatus1.Opacity = 0.;
			Label_SwitchStatus2.Opacity = 0.;
			Quad_Button_SwitchStatus2.Visible = False;
			Quad_Button_SwitchStatus1.Visible = False;
		} else if(!_IsTeamReady){
			Label_SwitchStatus1.Opacity = 0.3;
			Label_SwitchStatus2.Opacity = 0.3;
			Quad_Button_SwitchStatus2.Visible = True;
			Quad_Button_SwitchStatus1.Visible = True;
		}
		G_Frame_PlacesAvailable.Visible						= False;
		G_Frame_TeamStatus.Visible								= True;
		G_Frame_HideMenu.Visible									= True;
		G_Frame_Pager.Hide();
		G_Frame_ListPlayers.Visible		 						= False;
		G_Frame_BuddiesList.Visible								= False;
		G_Frame_AutoFillTeam.Visible	 						= True;
		G_Frame_HomeMenu.Visible 			 						= False;
		G_Frame_Autojoin.Visible 			 						= False;
		G_Frame_ListInvitation.Visible 						= False;
		G_Label_PlayersAvailable.Visible					= True;
		G_Frame_LeaveSquadButton.Visible					= True;
		G_Frame_Menu_PlayerListButton.Visible			= False;
		G_Frame_Menu.Visible 											= True;
		G_Frame_MenuTop.Visible										= False;
		G_HeaderMainSquad.Visible									= True;
		G_Frame_SquadMembers.Visible							= True;
		G_Frame_Menu_Invitation.Visible 						= False;
		G_Label_AlertNeedMates.Visible 							= False;
		G_RefreshUITime = Now;
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = False;
		EnableMenuNavigation(False, False, Null, 1);
		UpdateNotificationFrame(_TeamIsFull, _IsInAutoFill, _IsSpawned);
		G_Label_Notif_WaitForNextRound.Value			= "{{{RoyalSquad_PressReady_Text}}}";
		G_Label_Notif_WaitForNextRound.RelativePosition_V3.Y = -7.;
	} else if (_IsMember && !_IsLeader && _TeamIsFull && !_IsInAutoJoin && !_IsSpawned && !_IsSpectating){
		EnableMenuNavigation(False, False, Null, 1);
		G_PublicTeamCheck = True;
		G_PrivateTeamCheck = False;
		G_NewTeamStatusTimer = Now;
		if(!IsSwitchDisplayOn){
			G_MenuBackGround.Visible 					= False;
		} else {
			G_MenuBackGround.Visible 					= True;
		}
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = False;
		Label_SwitchStatus1.Opacity = 0.;
		Label_SwitchStatus2.Opacity = 0.;
		Quad_Button_SwitchStatus2.Visible = False;
		Quad_Button_SwitchStatus1.Visible = False;
		G_Frame_PlacesAvailable.Visible			= False;
		G_Frame_TeamStatus.Visible								= True;
		G_Frame_HideMenu.Visible									= True;
		G_Frame_Pager.Hide();
		G_Frame_ListPlayers.Visible		 						= False;
		G_Frame_BuddiesList.Visible								= False;
		G_Frame_AutoFillTeam.Visible	 						= False;
		G_Frame_HomeMenu.Visible 			 						= False;
		G_Frame_Autojoin.Visible 			 						= False;
		G_Frame_ListInvitation.Visible 						= False;
		G_Label_PlayersAvailable.Visible					= True;
		G_Frame_Menu_PlayerListButton.Visible			= False;
		G_Frame_Menu.Visible 											= True;
		G_Frame_MenuTop.Visible										= False;
		G_HeaderMainSquad.Visible									= True;
		G_Frame_LeaveSquadButton.Visible 					= True;
		G_Frame_SquadMembers.Visible							= True;
		UpdateNotificationFrame(_TeamIsFull, _IsInAutoFill, _IsSpawned);
		G_Frame_Menu_Invitation.Visible 						= False;
		G_Label_AlertNeedMates.Visible 							= False;
		
		G_Button_AutoFillTeam.Hide();
		G_RefreshUITime = Now;
	} else if(_IsSpawned && _IsLeader && !_IsInAutoJoin && !_IsSpectating && !G_SquadMenuAsked){
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = True;
		EnableMenuNavigation(False, False, Null, 1);
		G_Frame_PlacesAvailable.Visible			= False;
		Label_SwitchStatus1.Opacity = 0.;
		Label_SwitchStatus2.Opacity = 0.;
		Quad_Button_SwitchStatus2.Visible = False;
		Quad_Button_SwitchStatus1.Visible = False;
		G_Frame_HideMenu.Visible					= False;
		G_Frame_TeamStatus.Visible				= False;
		G_Frame_LeaveSquadButton.Visible  = False;
		G_Frame_Menu.Visible							= False;
		G_Frame_Autojoin.Visible 					= False;
		G_MenuBackGround.Visible 			 		= False;
		G_Frame_HomeMenu.Visible  		 		= False;
		G_Frame_ListInvitation.Visible 		= False;
		G_Frame_SquadMembers.Visible			= False;
		G_Frame_AutoFillTeam.Visible			= False;
		G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
		G_Frame_Menu_Invitation.Visible = False;
		G_RefreshUITime = Now;
		G_Frame_Pager.Visible					 			= False;
		G_Frame_BuddiesPager.Visible								= False;
		G_Label_PlayersAvailable.Visible		= False;
		G_Frame_ListPlayers.Visible		 			= False;
		G_Frame_BuddiesList.Visible					= False;
		G_Frame_MenuTop.Visible							= False;
		G_HeaderMainSquad.Visible						= False;
		G_Label_AlertNeedMates.Visible 			= False;
	} else if (_IsSpawned && _IsLeader && !_IsInAutoJoin && !_IsSpectating && G_SquadMenuAsked){
		G_HeaderMainSquad.Visible						= True;
		EnableMenuNavigation(True, False, Null, 1);
		G_Frame_SquadMembers.Visible			= True;
		G_Frame_Menu.Visible							= True;
		G_Frame_LeaveSquadButton.Visible	= True;
		G_Frame_Autojoin.Visible 					= False;
		if(!_IsInAutoFill || !_TeamIsFull){
			G_Frame_Menu_PlayerListHeaderFooter.Visible = True;
			G_Frame_ListPlayers.Visible		 		= True;
			if(Players.count > 10 && !_IsInAutoFill){
				G_Frame_Pager.Visible					 		= True;
			} else G_Frame_Pager.Visible					 		= False;
		} else {
			G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
			G_Frame_ListPlayers.Visible		 		= False;
			G_Frame_Pager.Visible					 		= False;
		}
		G_Frame_SmallBackGround.Visible	  = True;
		G_Frame_PressSquadButtonIcon.Visible = True;
		if(G_PrevLastOngletVisible == G_Frame_BuddiesList){
			G_Frame_BuddiesList.Visible = True;
			if(BuddiesInServer.count > 0 && G_Frame_BuddiesList.Visible == True){
				HandleUI_SelectionOnBuddies(True, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= False;
				G_Frame_BuddiesList.Visible								= True;
				G_Frame_Pager.Visible											= False;
			} else if (BuddiesInServer.count == 0 && G_Frame_ListPlayers.Visible == True){
				HandleUI_SelectionOnBuddies(False, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= True;
				G_Frame_BuddiesList.Visible								= False;
			}
		} else if (G_PrevLastOngletVisible == G_Frame_ListPlayers){
				G_Frame_ListPlayers.Visible = True;
				if(BuddiesInServer.count > 0 && G_Frame_BuddiesList.Visible == True){
				HandleUI_SelectionOnBuddies(True, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= False;
				G_Frame_BuddiesList.Visible								= True;
				G_Frame_Pager.Visible											= False;
			} else if (BuddiesInServer.count == 0 && G_Frame_ListPlayers.Visible == True){
				HandleUI_SelectionOnBuddies(False, BuddiesInServer);
				G_Frame_ListPlayers.Visible								= True;
				G_Frame_BuddiesList.Visible								= False;
			}
		}
		if(BuddiesInServer.count > 0 && G_Frame_BuddiesList.Visible == True){
			HandleUI_SelectionOnBuddies(True, BuddiesInServer);
			G_Frame_ListPlayers.Visible								= False;
			G_Frame_BuddiesList.Visible								= True;
			G_Frame_Pager.Visible											= False;
		} else if (BuddiesInServer.count == 0 && G_Frame_ListPlayers.Visible == True){
			HandleUI_SelectionOnBuddies(False, BuddiesInServer);
			G_Frame_ListPlayers.Visible								= True;
			G_Frame_BuddiesList.Visible								= False;
		}
		UpdateNotificationFrame(_TeamIsFull, _IsInAutoFill, _IsSpawned);
	} else if(_IsSpawned && _IsMember && !_IsLeader && !_IsInAutoJoin && !_IsSpectating && !G_SquadMenuAsked){
		G_Frame_SmallBackGround.Visible	  = False;
		G_Frame_PressSquadButtonIcon.Visible = True;
		EnableMenuNavigation(False, False, Null, 1);
		Label_SwitchStatus1.Opacity = 0.;
		Label_SwitchStatus2.Opacity = 0.;
		Quad_Button_SwitchStatus2.Visible = False;
		Quad_Button_SwitchStatus1.Visible = False;
		G_Frame_PlacesAvailable.Visible			= False;
		G_Frame_HideMenu.Visible					= False;
		G_Frame_TeamStatus.Visible				= False;
		G_Frame_LeaveSquadButton.Visible	= False;
		G_Frame_Autojoin.Visible 			 		= False;
		G_MenuBackGround.Visible			 		= False;
		G_Frame_HomeMenu.Visible			 		= False;
		G_Frame_ListInvitation.Visible 		= False;
		G_Frame_Pager.Visible					 		= False;
		G_Frame_BuddiesPager.Visible			= False;
		G_Frame_SquadMembers.Visible			= False;
		G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
		G_Frame_Menu_Invitation.Visible 	= False;
		G_Frame_AutoFillTeam.Visible			= False;
		G_Frame_ListPlayers.Visible		 		= False;
		G_Frame_BuddiesList.Visible				= False;
		G_Frame_Menu.Visible							= False;
		G_Frame_MenuTop.Visible						= False;
		G_HeaderMainSquad.Visible					= False;
		G_Label_AlertNeedMates.Visible 		= False;
		G_Label_PlayersAvailable.Visible	= False;
		G_RefreshUITime = Now;
	} else if (_IsSpawned && _IsMember && !_IsLeader && !_IsInAutoJoin && !_IsSpectating && G_SquadMenuAsked){
		G_HeaderMainSquad.Visible						= True;
		G_Frame_Autojoin.Visible 										= False;
		EnableMenuNavigation(True, False, Null, 1);
		G_Frame_SquadMembers.Visible			= True;
		G_Frame_ListPlayers.Visible		 		= False;
		G_Frame_Menu.Visible							= True;
		G_Frame_Pager.Visible					 		= False;
		G_Frame_LeaveSquadButton.Visible	= True;
		G_Frame_Menu_PlayerListHeaderFooter.Visible = False;
		G_Frame_SmallBackGround.Visible	  = True;
		G_Frame_PressSquadButtonIcon.Visible = True;
	} else {
		DebugLog(_IsMember, _IsLeader, _InATeamForMode, _IsSpawned, _AskForMenu, _IsInAutoJoin, _IsSpectating, _IsInAutoFill, _TeamIsFull);
	}
}

Boolean PlayerHasLeft(Text _PlayerLogin) {
	declare PlayerOfLogin <=> GetPlayerFromLogin(_PlayerLogin);
	return (PlayerOfLogin == Null || PlayerOfLogin.RequestsSpectate);
}

declare Integer G_AnimEnd;
declare Text G_LastAnimCalled;
declare Boolean G_IsAnimRunning;

Void SetFakeRank (){
	declare netwrite Integer Net_FakeRank for UI;
	if(LocalUser.Login == "nadeo_hervedafflon"){
		Net_FakeRank = 5;
	} else
	Net_FakeRank = ML::Rand(0, 50);
}
Void AdaptInvitationPosition(Text[] _InvitationList){
	if(_InvitationList.count == 0){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -20.;
	} else if (_InvitationList.count == 1){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -26.;
	} else if (_InvitationList.count == 2){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -32.5;
	} else if (_InvitationList.count == 3){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -39.;
	} else if (_InvitationList.count == 4){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -45.5;
	} else if (_InvitationList.count == 5){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -53.;
	} else if (_InvitationList.count == 6){
		G_Quad_InvitationBottom.RelativePosition_V3.Y = -59.5;
	}
}

Void UI_SquadOptions(Integer[] _SquadOptionsCheck){
	declare netwrite Integer[] Net_SquadOptionsCheck for UI;
	Net_SquadOptionsCheck = G_SquadOptionsCheck;
	declare MaxSquadOptions = [4, 3, 2, 1];
	foreach(Options in MaxSquadOptions){
		declare Options_Text = TL::ToText(Options);
		if(Options == 1){
			Options_Text = "Solo";
		}
		declare Quad_OptionsBackground <=> (Page.GetFirstChild("quad-contourcustom"^Options_Text) as CMlQuad);
		Quad_OptionsBackground.Opacity = 0.3;
	}
	foreach(OptionCheck in _SquadOptionsCheck){
		declare OptionsValue = TL::ToText(OptionCheck);
		if(OptionCheck == 1){
			OptionsValue = "Solo";
		}
		declare Quad_OptionsBackground <=> (Page.GetFirstChild("quad-contourcustom"^OptionsValue) as CMlQuad);
		Quad_OptionsBackground.Opacity = 1.;
		
	}
}

Void DisplaySquadOptions(Boolean _DisplaySquadOption){
	declare Label_SquadOptionCheck <=> (Page.GetFirstChild("label-checkcustomsquad") as CMlLabel);
	if(_DisplaySquadOption){
		G_Frame_CustomSquad.Visible = True;
		Label_SquadOptionCheck.Visible = True;
	} else {
		G_SquadOptionsCheck = [4];
		Label_SquadOptionCheck.Visible = False;
		G_Frame_CustomSquad.Visible = False;
	} 
	UI_SquadOptions(G_SquadOptionsCheck);
}

Void GetAllPlacesAvailable(Integer[Integer] _Net_PlacesAvailable){
	G_PlacesAvailable = 0;
	foreach(TeamConfig => Net_Places in _Net_PlacesAvailable){
		if(G_SquadOptionsCheck.exists(TeamConfig)){
			G_PlacesAvailable += _Net_PlacesAvailable[TeamConfig];
		}
	}
}

main() {
	InitTeamUI();
	SetFakeRank();
	declare Frame_ListInvitation 		<=> (G_Frame_Globale.GetFirstChild("frame-list-invitation") as CMlFrame);
	declare Frame_SquadMembers 			<=> (G_Frame_Globale.GetFirstChild("frame-squadmembers") as CMlFrame);
	declare BuddiesOnServer											 = False;
	declare PlayerListUpdate 		 			           = False;
	declare InvitationListUpdate 			           = True;
	declare IsLeader 						 			           = False;
	declare IsClicked 					 			           = False;
	declare IsUILoaded 					 			           = False;
	declare LeaderInFullTeamEventSend 					 = False;
	declare IsInAutoJoin												 = False;
	declare PrevIsInAutoJoin					           = False;
	declare PlayerInTeamEventSend 		           = False;
	declare AllPlayerInTeamSend 			           = False;
	declare IsMouseOver								           = False;
	declare IsPlayerSpectating				           = False;
	declare IsInAutoFill							           = False;
	declare Boolean PrevTeamIsFull;
	declare Boolean TeamIsFull;
	declare Boolean PrevPutInAutoJoin;	
	declare Boolean AskForMenu;
	declare Boolean PrevIsLeader;
	declare Integer PrevPlayersCount;
	declare netread Boolean IsInTeam  for UI;
	declare netread Boolean PutInAutoJoin for UI;
	declare Text[] PlayerLoginList;
	declare Text[] PlayerLoginToRemove;
	declare Ident[] PlayerIdsToRemove;
	declare Text[] InvitationList;
	declare Text[] RequesterToLeaderList;
	declare Text[] PlayerInvited;
	declare Text[] BuddiesList;
	declare Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, 1, IsClicked, G_Frame_ListPlayers.Visible);
	declare BuddiesPage = UpdateBuddiesPager(G_Frame_BuddiesPager, G_Frame_BuddiesList.Controls.count, BuddiesList.count, 1, IsClicked);
	declare netwrite Text[] Client_PlayersInTeamList for UI;
	declare Ident[] Client_AllPlayersInTeamList;
	declare Integer PrevIsInTeamTimer;
	declare Integer PrevIsInAutoJoinTimer;
	declare Integer PrevInATeamForModeTimer;
	declare Integer PrevIsPlayerSpawnedTimer;
	declare Integer PrevAskForMenuTimer;
	declare Integer AskForMenuTimer;
	declare Integer IsInAutoJoinTimer;
	declare Integer SquadMenuAskedTimer;
	declare Integer PrevSquadMenuAskedTimer;
	declare Integer IsPlayerSpectatingTimer;
	declare Boolean SpectatorUpdated;
	declare Integer PrevIsPlayerSpectatingTimer;
	declare Integer PrevIsLeaderChangeTimer;
	declare Integer IsLeaderChangeTimer;
	declare Integer PrevHasBeenInvited;
	declare Integer IsInAutoFillTimer;
	declare netread Integer AutoAutoFillTimer for UI;
	declare Integer PrevAutoAutoFillTimer = AutoAutoFillTimer;
	declare Integer PrevIsInAutoFillTimer;
	declare Integer PrevRestartTime;
	declare netread Integer Net_S_PlayersPerTeam for UI;
	declare netread Boolean IsPlayersUpdated for UI;
	declare Integer PrevPlayersPerTeam = 0;
	declare netread Integer ServerRestartTime for Teams[0];
	declare netread Text LoginOfInviter for UI;
	declare netread Text[] SquadForClient for UI;
	declare netread Text[] Net_AllPlayersInTeam for Teams[0];
	declare netread Integer Net_AllPlayersInTeamTimer for Teams[0];
	declare Integer PrevNet_AllPlayersInTeamTimer;
	declare Integer PrevAllPlayersInTeam;
	declare netread Boolean IsPlayerSpawned for UI;
	declare netwrite Boolean InATeamForMode for UI;
	declare Boolean PrevInATeamForMode;
	declare netread Text[] Net_InvitersToDelete for Teams[0];
	declare netread Integer IsInTeamTimer for UI;
	declare netread Integer IsPlayerSpawnedTimer for UI;
	declare netread Text[] Net_LeaderSpawnedList for Teams[0];
	declare netread Text[] Net_PlayersSpectating for Teams[0];
	declare netread Boolean Net_S_IsTeamNeedToBeFullToSpawn for Teams[0];
	declare netread Integer InvitersUpdatedTime for Teams[0];
	declare netread Text[] Net_PlayersInATeam for Teams[0];
	declare netread Text[] Net_PlayersInAutoJoin for Teams[0];
	declare Integer PrevPlayersInAutoJoin;
	declare Integer PrevInvitersUpdatedTime;
	declare netread Integer UpdateClientSquad for UI;
	declare netread Text[] Net_PlayersNeedHelp for UI;
	declare netread Text[] MatesHealed for UI;
	declare netread Boolean Net_RS_PlayerIsSpawning for UI;
	declare Integer PrevMatesHealedCount;
	declare Integer PrevUpdateClientSquad;
	declare Ident[] Spectators;
	declare Text[] PlayersJoined;
	declare Integer StartTime;
	declare Integer TimeDuration = 10000;
	declare Integer EndTime;
	declare Boolean IsBlinking = False;
	declare Boolean HasSetTimer = False;
	declare netread Boolean HideMenu for Teams[0];
	declare netread Integer	TeamRefresh	for Teams[0];
	declare Integer PrevTeamRefresh;
	declare Boolean ScoreTableVisible for UI;
	declare netread Integer HasBeenInvitedTime for UI;
	declare Integer InATeamForModeTimer;
	declare Boolean IsTutoFrameVisible for UI;
	declare netread Boolean HidePlayerUI for UI;
	declare Boolean PrevHidePlayerUI;
	declare Integer PrevBuddiesInServercount;
	declare Ident[] IdsOfAllPlayersInTeam;
	declare netread Integer Net_TS2_PlayersPerTeam for Teams[0];
	IsSwitchDisplayOn = True;
	declare netread Integer Net_MatesNumberSet for UI;
	declare netread Integer Net_MatesNumbersChanged for UI;
	declare Integer PrevNet_MatesNumbersChanged;
	G_MatesNumberSet = 4;
	declare Integer PrevNewTeamStatusTimer;
	declare Boolean IsTeamReady;
	declare Integer UpdateDisplaySquadOptionTimer; 
	declare Integer PrevUpdateDisplaySquadOptionTimer;
	declare Boolean DisplaySquadOption;
	G_SquadOptionsCheck = [4];
	declare OptionsChecked = G_SquadOptionsCheck.count;
	declare netread Integer[Integer] Net_PlacesAvailable for UI;
	UI_SquadOptions(G_SquadOptionsCheck);
	G_SquadMenuAsked = False;
	declare G_PrevSquadMenuAsked = False;
	declare Integer PrevSortClickedTime;
	declare Integer SortClickedTime;
	declare Boolean PrevPlayerIsSpawning;
	while (True) {
		yield;
		declare Owner <=> GetOwner();
		GetAllPlacesAvailable(Net_PlacesAvailable);
		if(G_Frame_PlacesAvailable.Visible){
			G_Label_PlacesAvailable.Value = TL::ToText(G_PlacesAvailable);
		}
		if(IsInAutoJoin && SquadForClient.existskey(0) && !IsInAutoFill){
			if(SquadForClient[0] == LocalUser.Login){
				IsInAutoFill = True;
				IsInAutoFillTimer = Now;
			}
		}
		if(AutoAutoFillTimer > PrevAutoAutoFillTimer && !IsInAutoFill && SquadForClient.count > 0){
			IsInAutoFill = True;
			IsInAutoFillTimer = Now;
			PrevAutoAutoFillTimer = AutoAutoFillTimer;
		}
		if(Net_TS2_PlayersPerTeam != PrevPlayersPerTeam){
			UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
			PrevPlayersPerTeam = Net_TS2_PlayersPerTeam;
		}
		if(PrevNet_MatesNumbersChanged != Net_MatesNumbersChanged){
			PrevNet_MatesNumbersChanged = Net_MatesNumbersChanged;
			G_MatesNumberSet = Net_MatesNumberSet;
			if(G_MatesNumberSet > Net_TS2_PlayersPerTeam){
				G_MatesNumberSet = Net_TS2_PlayersPerTeam;
			}
			UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
		}
		AdaptInvitationPosition(InvitationList);
		if(PrevBuddiesInServercount != BuddiesInServer.count){
			PrevBuddiesInServercount = BuddiesInServer.count;
			if(BuddiesInServer.count < 1){
				BuddiesOnServer = False;
				if(G_Frame_BuddiesList.Visible){
					G_Frame_ListPlayers.Visible	 = True;
					G_Label_BuddiesOnglet.Opacity = 1.;
					HandleUI_SelectionOnBuddies(False, BuddiesInServer);
				}
				G_Frame_BuddiesPager.Visible         = False;
				G_Button_BuddiesList.Visible 				 = False;
				G_Frame_BuddiesList.Visible					 = False;
				G_Quad_BuddiesList.Opacity = 0.;
				G_Quad_BuddiesListCadre.Opacity = 0.;
				G_Quad_TopLineInvitationList_Big.Opacity = 1.;
				G_Quad_Onglet_PlayersList.Opacity = 1.;
				G_Quad_Onglet_PlayersListCadre.Opacity = 0.;
				G_Label_BuddiesOnglet.Opacity = 0.5;
				Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, 1, IsClicked, G_Frame_ListPlayers.Visible);
				BuddiesPage = UpdateBuddiesPager(G_Frame_BuddiesPager, G_Frame_BuddiesList.Controls.count, BuddiesInServer.count, 1, IsClicked);
				UpdatePlayerList(G_Frame_ListPlayers, PlayerList, Page, PlayerInvited, Client_AllPlayersInTeamList, G_Label_MateSearched.Value, G_SortInTeamPlayersLast, SquadForClient);
				UpdateBuddiesList(G_Frame_BuddiesList, BuddiesList, PlayerList, BuddiesPage, PlayerInvited, Client_AllPlayersInTeamList, SquadForClient);
			} else {
				BuddiesOnServer = True;
				if(G_Frame_ListPlayers.Visible){
					G_Button_BuddiesList.Visible = True;
					G_Quad_BuddiesList.Opacity = 0.3;
					G_Quad_BuddiesListCadre.Opacity = 1.;
					G_Label_BuddiesOnglet.Opacity = 1.;
					G_Quad_Onglet_PlayersListCadre.Opacity = 0.;
				}
			} 
		}
		if(BuddiesInServer.count < 1){
			G_Frame_BuddiesList.Visible = False;
			G_Label_BuddiesOnglet.Value = "{{{RoyalSquad_NoFriends_Text}}}";
		} else G_Label_BuddiesOnglet.Value = "{{{RoyalSquad_Friends_Text}}}";

		if(IsPlayerSpawned){
			IsInAutoJoin = False;
			G_Label_SwitchDisplay.Value = "{{{RoyalSquad_HideMenu_Text}}}";
			IsSwitchDisplayOn = True;
			G_Label_SwitchDisplay_TeamState.Visible = False;
			if(PrevIsInAutoJoin != IsInAutoJoin){
				IsInAutoJoinTimer = Now;
				PrevIsInAutoJoin = IsInAutoJoin;
			}
		} else {
			G_SquadMenuAsked = False;
			if(G_SquadMenuAsked != G_PrevSquadMenuAsked){
				SquadMenuAskedTimer = Now;
				G_PrevSquadMenuAsked = G_SquadMenuAsked;
			}
		}
		if(InvitationList.count == 0){
			G_Label_InvitationMenu.Value = "{{{RoyalSquad_NoInvitation_Text}}}";
		} else G_Label_InvitationMenu.Value = "{{{RoyalSquad_Invitations_Text}}}";
		//add the buddy of the players in the BuddiesList
		if (ManiaPlanet != Null && ManiaPlanet.ChatManager != Null) {
			foreach(Buddy in ManiaPlanet.ChatManager.Buddies){
				declare Text BuddyLogin;
				BuddyLogin = Buddy.Login;
				if(!BuddiesList.exists(BuddyLogin) && Buddy.IsOnline){
					BuddiesList.add(BuddyLogin);
				}
			}
		}
		if(PutInAutoJoin != PrevPutInAutoJoin && PutInAutoJoin){
			IsInAutoJoin = True;
			PrevPutInAutoJoin = PutInAutoJoin;
			if(PrevIsInAutoJoin != IsInAutoJoin){
				IsInAutoJoinTimer = Now;
				PrevIsInAutoJoin = IsInAutoJoin;
			}
		} 
		if(TeamRefresh > PrevTeamRefresh){
			PlayerListUpdate = True;
		}
		if(PrevIsInAutoJoin != IsInAutoJoin){
			IsInAutoJoinTimer = Now;
			PrevIsInAutoJoin = IsInAutoJoin;
		}
		//Manage Page UI Visibility
		if(Net_PlayersSpectating.exists(LocalUser.Login) || HideMenu){
			G_Frame_Globale.Visible = False;
			G_MenuBackGround.Visible = False;
			G_Frame_HideMenu.Visible = False;
			if(Net_PlayersSpectating.exists(LocalUser.Login)){
				IsPlayerSpectating = True;
				IsPlayerSpectatingTimer = Now;
				IsInAutoJoin = False;
				SpectatorUpdated = False;
				if(PrevIsInAutoJoin != IsInAutoJoin){
					IsInAutoJoinTimer = Now;
					PrevIsInAutoJoin = IsInAutoJoin;
				}
			}
		} else if(!Net_PlayersSpectating.exists(LocalUser.Login) && !IsPlayerSpawned && !HideMenu && !ScoreTableVisible && IsSwitchDisplayOn) {
			G_MenuBackGround.Visible = True;
			G_Frame_Globale.Visible = True;
			
			if(!Net_PlayersSpectating.exists(LocalUser.Login) && !SpectatorUpdated){
				IsPlayerSpectating = False;
				IsPlayerSpectatingTimer = Now;
				SpectatorUpdated = True;
			}
		}
		if(!Net_PlayersSpectating.exists(LocalUser.Login) && !IsPlayerSpawned && !HideMenu && !ScoreTableVisible){
			G_Frame_HideMenu.Visible = True;
		}
		else if (ScoreTableVisible){
			G_Frame_Globale.Visible = False;
		} else if (!ScoreTableVisible && IsPlayerSpawned && !Net_PlayersSpectating.exists(LocalUser.Login) && !HideMenu && IsSwitchDisplayOn){
			G_Frame_Globale.Visible = True;
		}
		if(IsTutoFrameVisible) {
			G_Frame_Globale.Hide();
			G_MenuBackGround.Hide();
		} else {
			if(!IsPlayerSpawned && !ScoreTableVisible && !Net_PlayersSpectating.exists(LocalUser.Login) && !HideMenu && IsSwitchDisplayOn){
				G_MenuBackGround.Show();
				G_Frame_Globale.Show();
			}
		}
	
		if(ServerRestartTime > PrevRestartTime){
			IsSwitchDisplayOn = True;
			UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
			InvitationList = [];
			PlayerLoginToRemove = [];
			RequesterToLeaderList = [];
			PlayerInvited = [];
			Client_PlayersInTeamList = [];
			PlayerIdsToRemove = [];
			InATeamForMode = False;
			if(PrevInATeamForMode != InATeamForMode){
				InATeamForModeTimer = Now;
				PrevInATeamForMode = InATeamForMode;
			}
			
			G_Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
			G_PrivateTeamCheck = False;
			G_PublicTeamCheck = True;
			G_NewTeamStatusTimer = Now;
			IsTeamReady = False;
			PrevIsInAutoJoin = False;
			InvitationListUpdate = True;
			IsInAutoFill = False;
			IsInAutoFillTimer = Now;
			IsClicked = False;
			PrevPutInAutoJoin = False;
			LeaderInFullTeamEventSend = False;
			AskForMenu = False;
			AllPlayerInTeamSend = False;
			PlayerInTeamEventSend = False;
			IsUILoaded = False;
			IsLeader = False;
			if(PrevIsLeader != IsLeader){
				IsLeaderChangeTimer = Now;
				PrevIsLeader = IsLeader;
			}
			G_MatesNumberSet = 4;
			IsInAutoJoin = False;
			PrevRestartTime = ServerRestartTime;
			G_SquadOptionsCheck = [4];
			UI_SquadOptions(G_SquadOptionsCheck);
			LoadTeamUI(IsInTeam, IsLeader, InATeamForMode, IsPlayerSpawned, AskForMenu, IsInAutoJoin, IsPlayerSpectating, IsInAutoFill, TeamIsFull, IsTeamReady);
			InvitationListUpdate = True;
		}	
		Client_PlayersInTeamList = Net_PlayersInATeam;
		if(Net_AllPlayersInTeamTimer > PrevNet_AllPlayersInTeamTimer){
			PrevNet_AllPlayersInTeamTimer = Net_AllPlayersInTeamTimer;
			PrevAllPlayersInTeam = Net_AllPlayersInTeam.count;
			foreach(LoginOfPlayerInTeam in Net_AllPlayersInTeam){
				declare IdOfPlayerInTeam = GetIdFromLogin(LoginOfPlayerInTeam);
				if(!IdsOfAllPlayersInTeam.exists(IdOfPlayerInTeam)){
					IdsOfAllPlayersInTeam.add(IdOfPlayerInTeam);
				}
			}
			foreach(IdOfPlayerInTeam in IdsOfAllPlayersInTeam){
				declare LoginOfPlayerInTeam = GetLoginFromId(IdOfPlayerInTeam);
				if(!Net_AllPlayersInTeam.exists(LoginOfPlayerInTeam)){
					IdsOfAllPlayersInTeam.remove(IdOfPlayerInTeam);
				}
			}
		}
		Client_AllPlayersInTeamList = IdsOfAllPlayersInTeam;
		if(Net_PlayersInAutoJoin.count != PrevPlayersInAutoJoin){
			PrevPlayersInAutoJoin = Net_PlayersInAutoJoin.count; 
		}
		foreach(PlayerWaiting in Net_PlayersInAutoJoin){
			declare PlayerOfPlayerWaiting <=> GetPlayerFromLogin(PlayerWaiting);
			if(PlayerOfPlayerWaiting != Null){
				if(Client_AllPlayersInTeamList.exists(PlayerOfPlayerWaiting.Id)){
					Client_AllPlayersInTeamList.remove(PlayerOfPlayerWaiting.Id);
					IdsOfAllPlayersInTeam.remove(PlayerOfPlayerWaiting.Id);
				}
			}
		}
		//Remove Invitation from players that are in team
		if(Client_PlayersInTeamList.count > 0 && InvitationList.count > 0){
			foreach (PlayerInTeam in Client_PlayersInTeamList){
				foreach (Inviter in InvitationList){
					declare InviterInTeamToDelete = GetNameFromLogin(Inviter);
					if (PlayerInTeam == InviterInTeamToDelete){
						Client_PlayersInTeamList.remove(PlayerInTeam);
						InvitationList.remove(Inviter);
						UpdateInvitationList(Frame_ListInvitation, InvitationList);
					}
				}
			}
		}
		//Remove invitation from other players when they leave the Team Creation Menu
		if(InvitersUpdatedTime > PrevInvitersUpdatedTime){
			foreach(InviterToDelete in Net_InvitersToDelete){
				if(InvitationList.exists(InviterToDelete)){
					InvitationList.remove(InviterToDelete);
					InvitationListUpdate = True;
				}
			}
			PrevInvitersUpdatedTime = InvitersUpdatedTime;
		}
		//Reset player state when the player isn't in team
		if(!SquadForClient.exists(LocalUser.Login)){
			IsLeader = False;
			G_PrivateTeamCheck = False;
			LeaderInFullTeamEventSend = False;
			PlayerInTeamEventSend = True;
			IsUILoaded = False;
			AllPlayerInTeamSend = False;
			AskForMenu = False;
			if(PrevIsLeader != IsLeader){
				IsLeaderChangeTimer = Now;
				PrevIsLeader = IsLeader;
			}
		}
		if(IsInTeam && !AllPlayerInTeamSend){
			SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_AllPlayersInTeam}}}", [LocalUser.Login]);
			AllPlayerInTeamSend = True;
		}
		foreach (PlayerIndex => Member in SquadForClient) {
			if(PlayerInvited.exists(Member)){
				PlayerInvited.remove(Member);
			}
			//Check si je suis le leader (le leader est toujours etre le premier champ du tableau)
			if (LocalUser.Login == SquadForClient[0] && SquadForClient.exists(LocalUser.Login)) {
				IsLeader = True;
				if(PrevIsLeader != IsLeader){
					UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
					IsLeaderChangeTimer = Now;
					PrevIsLeader = IsLeader;
				}
				if (IsLeader){
					//Faire une fonction Load Team Leader UI
					if(!IsUILoaded){
						IsUILoaded = !IsUILoaded;
					}
				}
			}
		}
		if (SquadForClient.count >= Net_S_PlayersPerTeam && SquadForClient.count != 0 || SquadForClient.count >= G_MatesNumberSet && SquadForClient.count != 0){//La squad du client depasse ou est egal au nombre de player requis pour jouer
			InATeamForMode = True;
			if(PrevInATeamForMode != InATeamForMode){
				InATeamForModeTimer = Now;
				PrevInATeamForMode = InATeamForMode;
			}
			if(IsLeader && !LeaderInFullTeamEventSend || !PlayerInTeamEventSend){
				SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_LeaderInFullTeam}}}", [LocalUser.Login]);//Use it to delete leader from leaders available to join
				SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_MemberInTeam}}}", [LocalUser.Login]);//Use it to delete invite from leader
				UpdateSquadMembers(Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
				LeaderInFullTeamEventSend = True;
				PlayerInTeamEventSend = True;
			}
		}
		if(SquadForClient.count < Net_S_PlayersPerTeam || SquadForClient.count < G_MatesNumberSet){
			if(TeamIsFull != False){
				TeamIsFull = False;
			}
		} 
		
		if (SquadForClient.count >= Net_S_PlayersPerTeam || SquadForClient.count >= G_MatesNumberSet){
			TeamIsFull		 = True;
		}
		if(TeamIsFull != PrevTeamIsFull){
			InATeamForModeTimer = Now;
			PrevTeamIsFull = TeamIsFull;
		}
		if(!Net_S_IsTeamNeedToBeFullToSpawn){
			if(SquadForClient.existskey(0)){//The player has spawned and is at least the last member of his team
				if(Net_LeaderSpawnedList.exists(SquadForClient[0])){
					InATeamForMode = True;
					if(PrevInATeamForMode != InATeamForMode){
						InATeamForModeTimer = Now;
						PrevInATeamForMode = InATeamForMode;
					}
				}
			} else InATeamForMode = False;//No player in his team
		}
		else if(Net_S_IsTeamNeedToBeFullToSpawn){
			if(SquadForClient.count < Net_S_PlayersPerTeam){
				InATeamForMode = False;
				if(PrevInATeamForMode != InATeamForMode){
					InATeamForModeTimer = Now;
					PrevInATeamForMode = InATeamForMode;
				}
			}
		}
		//Manage Animation
		if(G_IsMouseOver_AutoJoin){
			G_X = Now * 0.003;
			G_Quad_ContourAutoJoin.Opacity = ML::Abs(ML::Sin(G_X))/1.5 + 0.3;
		}
		else if(G_IsMouseOver_CreateTeam){
			G_X = Now * 0.003;
			G_Quad_ContourCreateTeam.Opacity = ML::Abs(ML::Sin(G_X))/1.5 + 0.3;
		}
		else if(G_IsMouseOver_TeamReady){
			G_X = Now * 0.003;
			G_Quad_ContourAutoFill.Opacity = ML::Abs(ML::Sin(G_X))/1.5 + 0.3;
		} else if (G_IsMouseOver_LeaveTeam){
			G_X = Now * 0.003;
			G_Quad_LeaveTeamContour.Opacity = ML::Abs(ML::Sin(G_X))/1.5 + 0.3;
		} else {
			G_Quad_ContourAutoJoin.Opacity = 1.;
			G_Quad_ContourCreateTeam.Opacity = 1.;
			G_Quad_LeaveTeamContour.Opacity = 1.;
		}
		
		if(G_Frame_ListPlayers.Visible){
			foreach(Control in G_Frame_ListPlayers.Controls){
				declare Frame_Player <=> (Control as CMlFrame);
				declare Quad_Underline <=> (Frame_Player.GetFirstChild("quad-playerselected") as CMlQuad);
				if(Quad_Underline.Visible == True){
					G_OpacitySentQuad = Now * 0.003;
					Quad_Underline.Opacity = ML::Abs(ML::Sin(G_OpacitySentQuad))/1.5 + 0.3;
				}
			}
		}
		if(G_Frame_BuddiesList.Visible){
			foreach(Control in G_Frame_BuddiesList.Controls){
				declare Frame_Player <=> (Control as CMlFrame);
				declare Quad_Underline <=> (Frame_Player.GetFirstChild("quad-buddyplayerselected") as CMlQuad);
				if(Quad_Underline.Visible == True){
					G_OpacitySentQuad = Now * 0.003;
					Quad_Underline.Opacity = ML::Abs(ML::Sin(G_OpacitySentQuad))/1.5 + 0.3;
				}
			}
		}
		if(G_Label_LoadingNotification.Visible){
			G_Label_LoadingNotification.RelativeRotation -= 2.;
		}
		//Manage UI when the player is in a Team but not the leader
		if(IsInTeam && !IsLeader){
			//Send to the server that the player is a team member
			if(!PlayerInTeamEventSend){
				UpdateSquadMembers(Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
				SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_MemberInTeam}}}", [LocalUser.Login]);
				PlayerInTeamEventSend = True;
				
			}
		}
		//Display Squad
		if(UpdateClientSquad > PrevUpdateClientSquad || MatesHealed.count != PrevMatesHealedCount){
			UpdateSquadMembers(Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
			PrevUpdateClientSquad = UpdateClientSquad;
			PrevMatesHealedCount = MatesHealed.count;
		}
		// Manage all players in the player list
		foreach (Player in Players) {		
			if (HasBeenInvitedTime > PrevHasBeenInvited) {
				if (!InvitationList.exists(LoginOfInviter) && LoginOfInviter != ""){
					InvitationList.add(LoginOfInviter);
					InvitationListUpdate = True;
				}
				PrevHasBeenInvited = HasBeenInvitedTime;
			}	
			if (!Player.RequestsSpectate &&!PlayerLoginList.exists(Player.User.Login)) {
				if(Player != Null){
					PlayerLoginList.add(Player.User.Login);
				}
				PlayerListUpdate = True;
				InvitationListUpdate = True;
			}
			foreach(Spectator in Spectators){
				if(!Net_PlayersSpectating.exists(Player.User.Login)){
					Spectators.remove(Spectator);
				}
			}
			if (!Player.RequestsSpectate && Player.User.Login != LocalUser.Login && !PlayerList.exists(Player.Id)) {
				PlayerList.add(Player.Id);
				PlayerListUpdate = True;
				InvitationListUpdate = True;
			}
		}
		if(Players.count != PrevPlayersCount){
			foreach (PlayerLogin in PlayerLoginList) {
				if (PlayerHasLeft(PlayerLogin)) {
					PlayerLoginToRemove.add(PlayerLogin);
				}
			}
			foreach (PlayerLogin in PlayerLoginToRemove) {
				declare RemovedFromPlayerList = PlayerLoginList.remove(PlayerLogin);
				PlayerListUpdate = True;
				InvitationListUpdate = True;
			}
			foreach(PlayerSpectating in Net_PlayersSpectating){
				declare IdOfPlayers = GetIdFromLogin(PlayerSpectating);
				if(!Spectators.exists(IdOfPlayers)){
					Spectators.add(IdOfPlayers);
				} 
			}
			if(Players.count != PrevPlayersCount){
				foreach (PlayerId in PlayerList) {
					if (!Players.existskey(PlayerId) || Players[PlayerId].RequestsSpectate || Spectators.exists(PlayerId)) {
						PlayerIdsToRemove.add(PlayerId);
					}
				}
				PrevPlayersCount = Players.count;
			}
		}
		foreach (PlayerId in PlayerIdsToRemove) {
			declare RemovedFromPlayerList = PlayerList.remove(PlayerId);
			PlayerIdsToRemove.remove(PlayerId);
			PlayerListUpdate = True;
			InvitationListUpdate = True;
		}
		if(SquadForClient.count == G_MatesNumberSet){
			IsInAutoJoin = False;
		}
		if(PrevIsInAutoJoin != IsInAutoJoin){
			IsInAutoJoinTimer = Now;
			PrevIsInAutoJoin = IsInAutoJoin;
		}
		//Load UI
		if(IsInTeamTimer > PrevIsInTeamTimer ||
			AskForMenuTimer > PrevAskForMenuTimer ||
			SquadMenuAskedTimer > PrevSquadMenuAskedTimer || InATeamForModeTimer > PrevInATeamForModeTimer || IsPlayerSpawnedTimer > PrevIsPlayerSpawnedTimer || IsInAutoJoinTimer > PrevIsInAutoJoinTimer || IsLeaderChangeTimer > PrevIsLeaderChangeTimer || IsInAutoFillTimer > PrevIsInAutoFillTimer || IsPlayerSpectatingTimer > PrevIsPlayerSpectatingTimer){
			if(G_Frame_ListPlayers.Visible){
				G_PrevLastOngletVisible = G_Frame_ListPlayers;
			}	else if (G_Frame_BuddiesList.Visible){
				G_PrevLastOngletVisible = G_Frame_BuddiesList;
			}
			
			LoadTeamUI(IsInTeam, IsLeader, InATeamForMode, IsPlayerSpawned, AskForMenu, IsInAutoJoin, IsPlayerSpectating, IsInAutoFill, TeamIsFull, IsTeamReady);
			PrevIsInTeamTimer = IsInTeamTimer;
			PrevSquadMenuAskedTimer = SquadMenuAskedTimer;
			PrevIsPlayerSpectatingTimer = IsPlayerSpectatingTimer;
			PrevIsInAutoJoinTimer = IsInAutoJoinTimer;
			PrevInATeamForModeTimer = InATeamForModeTimer;
			PrevIsPlayerSpawnedTimer = IsPlayerSpawnedTimer;
			PrevIsLeaderChangeTimer = IsLeaderChangeTimer;
			PrevIsInAutoFillTimer = IsInAutoFillTimer;
			PrevAutoAutoFillTimer = AutoAutoFillTimer;
		}
		G_Label_PlayersAvailable.Value = "Potential teammates  : "^TL::ToText(G_PlayersAvailable);
		
		if(PlayerListUpdate || TeamRefresh > PrevTeamRefresh ){
			Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, Page, IsClicked, G_Frame_ListPlayers.Visible);
			UpdatePlayerList(G_Frame_ListPlayers, PlayerList, Page, PlayerInvited, Client_AllPlayersInTeamList, G_Label_MateSearched.Value, G_SortInTeamPlayersLast, SquadForClient);
			BuddiesPage = UpdateBuddiesPager(G_Frame_BuddiesPager, G_Frame_BuddiesList.Controls.count, BuddiesList.count, BuddiesPage, IsClicked);
			UpdateBuddiesList(G_Frame_BuddiesList, BuddiesList, PlayerList, BuddiesPage, PlayerInvited, Client_AllPlayersInTeamList, SquadForClient);
			PlayerListUpdate = False;
			PrevTeamRefresh = TeamRefresh;
		}
		
		if (InvitationListUpdate) {
			UpdateInvitationList(Frame_ListInvitation, InvitationList);
		}
		
		if(G_Frame_Autojoin.Visible && G_Label_AutoJoin.Value == "{{{RoyalSquad_STARTMATCHMAKING_Text}}}" && InvitationList.count == 0) {
			if(!HasSetTimer) {
				StartTime = Now;
				EndTime = StartTime + TimeDuration;
				HasSetTimer = True;
			}
			if(Now>= EndTime && !IsBlinking) {
				IsBlinking = True;
			}
			if(IsBlinking) {
				if(!G_Quad_Ready_CallToAction.Visible) G_Quad_Ready_CallToAction.Show();
				G_X = Now * 0.003;
				G_Quad_Ready_CallToAction.Opacity = ML::Abs(ML::Sin(G_X))/1.5 + 0.3;
			}
		} else {
			G_Quad_Ready_CallToAction.Opacity = 0.;
			if(G_Quad_Ready_CallToAction.Visible) G_Quad_Ready_CallToAction.Hide();
			HasSetTimer = False;
			IsBlinking = False;
		}
		if(HidePlayerUI && PrevHidePlayerUI != HidePlayerUI){
			PrevHidePlayerUI = HidePlayerUI;
			G_Frame_Globale.Visible = False;
			G_MenuBackGround.Visible = False;
			G_Label_SwitchDisplay_TeamState.Visible = True;
			IsSwitchDisplayOn = False;
			G_Label_SwitchDisplay.Value = "{{{RoyalSquad_ShowMenu_Text}}}";
		} else if (!HidePlayerUI && PrevHidePlayerUI != HidePlayerUI){
			PrevHidePlayerUI = HidePlayerUI;
		}

		if(UpdateDisplaySquadOptionTimer > PrevUpdateDisplaySquadOptionTimer){
			PrevUpdateDisplaySquadOptionTimer = UpdateDisplaySquadOptionTimer;
			DisplaySquadOptions(DisplaySquadOption);
		}

		if(Now > SortClickedTime + 150 && G_SortPlayerClicked){
			PrevSortClickedTime = SortClickedTime;
			G_SortPlayerClicked = False;
			G_Button_SortPlayersList.Opacity = 0.3;
			G_Button_SortPlayersList.BgColor = CL::HexToRgb("1A1A1AFF");
		}
		foreach (Event in PendingEvents) {
			switch (Event.Type) {
				case CMlScriptEvent::Type::KeyPress: {
					if(Event.KeyName == "N" && Net_RS_PlayerIsSpawning == False){
						if(G_SquadMenuAsked && IsPlayerSpawned){
							G_SquadMenuAsked = False;
							G_Frame_Pager.Visible = False;
							Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, Page, IsClicked, G_Frame_ListPlayers.Visible);
							UpdatePlayerList(G_Frame_ListPlayers, PlayerList, Page, PlayerInvited, Client_AllPlayersInTeamList, G_Label_MateSearched.Value, G_SortInTeamPlayersLast, SquadForClient);
							if(G_SquadMenuAsked != G_PrevSquadMenuAsked){
								SquadMenuAskedTimer = Now;
								G_PrevSquadMenuAsked = G_SquadMenuAsked;
							}
						} else if (!G_SquadMenuAsked && IsPlayerSpawned){
							G_SquadMenuAsked = True;
							if(!IsInAutoFill || (IsLeader && Players.count > 10 && !IsInAutoFill)){
								G_Frame_Pager.Visible = True;
							} else G_Frame_Pager.Visible = False;
							if(IsInAutoFill){
								G_Frame_ListPlayers.Visible = False;
								G_Frame_Pager.Visible = False;
							}
							Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, Page, IsClicked, G_Frame_ListPlayers.Visible);
							UpdatePlayerList(G_Frame_ListPlayers, PlayerList, Page, PlayerInvited, Client_AllPlayersInTeamList, G_Label_MateSearched.Value, G_SortInTeamPlayersLast, SquadForClient);
							if(G_SquadMenuAsked != G_PrevSquadMenuAsked){
								SquadMenuAskedTimer = Now;
								G_PrevSquadMenuAsked = G_SquadMenuAsked;
							}
						}
					}
				}
				case CMlScriptEvent::Type::MouseClick: {
					if(Event.ControlId == "button-buddieslist"){
						G_Frame_BuddiesList.Visible 	= True;
						G_Frame_ListPlayers.Visible		= False;
						G_Frame_Pager.Visible					= False;
						if(BuddiesList.count > 10){
							G_Frame_BuddiesPager.Visible	= True;
						}
						HandleUI_SelectionOnBuddies(True, BuddiesInServer);
					} 
					else if (Event.ControlId == "button-backtogame"){
						if(G_SquadMenuAsked && IsPlayerSpawned){
							G_SquadMenuAsked = False;
							G_Frame_Pager.Visible = False;
							Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, Page, IsClicked, G_Frame_ListPlayers.Visible);
							UpdatePlayerList(G_Frame_ListPlayers, PlayerList, Page, PlayerInvited, Client_AllPlayersInTeamList, G_Label_MateSearched.Value, G_SortInTeamPlayersLast, SquadForClient);
							if(G_SquadMenuAsked != G_PrevSquadMenuAsked){
								SquadMenuAskedTimer = Now;
								G_PrevSquadMenuAsked = G_SquadMenuAsked;
							}
						}
					}
					else if (Event.ControlId == "button-addmate"){
						SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_AddMembersNumbers}}}", [LocalUser.Login]);
					} else if (Event.ControlId == "button-removemate"){
						SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_RemoveMembersNumbers}}}", [LocalUser.Login]);
					}
					 
					else if (Event.ControlId == "button-switchStatus1" || Event.ControlId == "button-switchStatus2"){
						declare Label_TeamStatus <=> (G_Frame_TeamStatus.GetFirstChild("label-TeamStatus") as CMlLabel);
						PlayerListUpdate = True;
						if(Label_TeamStatus.Value == "{{{RoyalSquad_PublicTeam_Text}}}"){
							Label_TeamStatus.Value = "{{{RoyalSquad_PrivateTeam_Text}}}";
							SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_ResetMembersNumbers}}}", [LocalUser.Login]);
						} else if (Label_TeamStatus.Value == "{{{RoyalSquad_PrivateTeam_Text}}}"){
							Label_TeamStatus.Value = "{{{RoyalSquad_PublicTeam_Text}}}";
						}
						G_PublicTeamCheck = !G_PublicTeamCheck;
						G_PrivateTeamCheck = !G_PrivateTeamCheck;
						G_NewTeamStatusTimer = Now;
						UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
					} else if(Event.ControlId == "button-displaycustomsquad"){
						declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						DisplaySquadOption = !DisplaySquadOption;
						UpdateDisplaySquadOptionTimer = Now;
						Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
					} 
						if (Event.ControlId == "button-custom4"){
							declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
							if(!G_SquadOptionsCheck.exists(4)){
								G_SquadOptionsCheck.add(4);
								G_SquadOptionsCheck.remove(1);
							} else {
								if (OptionsChecked > 1){
									G_SquadOptionsCheck.remove(4);
								}
							} 
							Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
							OptionsChecked = G_SquadOptionsCheck.count;
							UI_SquadOptions(G_SquadOptionsCheck);
							declare netwrite Integer[] Net_SquadOptionsCheck for UI;
							Net_SquadOptionsCheck = G_SquadOptionsCheck;
						} else if (Event.ControlId == "button-custom3"){
							declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
							if(!G_SquadOptionsCheck.exists(3)){
								G_SquadOptionsCheck.add(3);
								G_SquadOptionsCheck.remove(1);
							} else {
								if (OptionsChecked > 1){
									G_SquadOptionsCheck.remove(3);
								}
							}
							Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
							OptionsChecked = G_SquadOptionsCheck.count;
							UI_SquadOptions(G_SquadOptionsCheck);
							declare netwrite Integer[] Net_SquadOptionsCheck for UI;
							Net_SquadOptionsCheck = G_SquadOptionsCheck;
						} else if (Event.ControlId == "button-custom2"){
							declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
							if(!G_SquadOptionsCheck.exists(2)){
								G_SquadOptionsCheck.add(2);
								G_SquadOptionsCheck.remove(1);
							} else {
								if (OptionsChecked > 1){
									G_SquadOptionsCheck.remove(2);
								}
							} 
							Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
							OptionsChecked = G_SquadOptionsCheck.count;
							UI_SquadOptions(G_SquadOptionsCheck);
							declare netwrite Integer[] Net_SquadOptionsCheck for UI;
							Net_SquadOptionsCheck = G_SquadOptionsCheck;
						} else if (Event.ControlId == "button-customSolo"){
							declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
							if(!G_SquadOptionsCheck.exists(1)){
								G_SquadOptionsCheck.clear();
								G_SquadOptionsCheck.add(1);
							} else {
								if (OptionsChecked > 1){
									G_SquadOptionsCheck.remove(1);
								}
							} 
							Label_AutoJoin.Value = "{{{RoyalSquad_Ready_Text}}}";
							OptionsChecked = G_SquadOptionsCheck.count;
							declare netwrite Integer[] Net_SquadOptionsCheck for UI;
							Net_SquadOptionsCheck = G_SquadOptionsCheck;
							UI_SquadOptions(G_SquadOptionsCheck);
						}
					
					
					else if(Event.ControlId == "button-SwitchMenuDisplay") {
						
						if(G_Label_SwitchDisplay.Value == "{{{RoyalSquad_HideMenu_Text}}}"){
							G_Frame_Globale.Visible = False;
							G_MenuBackGround.Visible = False;
							G_Label_SwitchDisplay_TeamState.Visible = True;
							IsSwitchDisplayOn = False;
							G_Label_SwitchDisplay.Value = "{{{RoyalSquad_ShowMenu_Text}}}";
							
						} else if (G_Label_SwitchDisplay.Value == "{{{RoyalSquad_ShowMenu_Text}}}"){
							G_Label_SwitchDisplay.Value = "{{{RoyalSquad_HideMenu_Text}}}";
							IsSwitchDisplayOn = True;
							G_Label_SwitchDisplay_TeamState.Visible = False;
						}

					}
					else if(Event.ControlId == "button-playerslist"){
						G_Frame_BuddiesList.Visible		= False;
						G_Frame_ListPlayers.Visible		= True;
						if(PlayerList.count > 10 && !G_Frame_BuddiesList.Visible){
							G_Frame_Pager.Visible					= True;
							PlayerListUpdate = True;
						}
						G_Frame_BuddiesPager.Visible	= False;
						HandleUI_SelectionOnBuddies(False, BuddiesInServer);
					}
					else if(Event.ControlId == "button-sortplayerslist"){
						G_SortInTeamPlayersLast = True;
						G_SortPlayerClicked = True;
						SortClickedTime = Now;
						PlayerListUpdate = True;
						G_Button_SortPlayersList.Opacity = .5;
						G_Button_SortPlayersList.BgColor = CL::HexToRgb("AAAF");
					}
					else if (Event.ControlId == "button-autojoin"){
						declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						declare Frame_CancelAutoJoinTeam <=> (G_Frame_Globale.GetFirstChild("frame-cancelautojointeam") as CMlFrame);
						declare Button_AutoJoin <=> (G_Frame_Globale.GetFirstChild("button-autojoin") as CMlQuad);
						declare Quad_AutoJoinContour <=> (G_Frame_Globale.GetFirstChild("quad-contourautojoin") as CMlQuad);
						G_UseTeamCreation = False;
						if(Label_AutoJoin.Value == "{{{RoyalSquad_STARTMATCHMAKING_Text}}}" || Label_AutoJoin.Value == "{{{RoyalSquad_Ready_Text}}}"){
							SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_PlayerInAutoJoin}}}", [LocalUser.Login]);
							declare netwrite Integer[] Net_SquadOptionsCheck for UI;
							Net_SquadOptionsCheck = G_SquadOptionsCheck;
							PlayerListUpdate = True;
							IsInAutoJoin = True;
							IsTeamReady = True;
							IsInAutoJoinTimer = Now;
							Label_AutoJoin.Value = "{{{RoyalSquad_Cancel_Text}}}";
						} else if (Label_AutoJoin.Value == "{{{RoyalSquad_Cancel_Text}}}"){
							declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
							declare Frame_CancelAutoJoinTeam <=> (G_Frame_Globale.GetFirstChild("frame-cancelautojointeam") as CMlFrame);
							declare Button_AutoJoin <=> (G_Frame_Globale.GetFirstChild("button-autojoin") as CMlQuad);
							declare Quad_AutoJoinContour <=> (G_Frame_Globale.GetFirstChild("quad-contourautojoin") as CMlQuad);
							SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_PlayerCancelAutoJoin}}}", [LocalUser.Login]);
							IsMouseOver = False;
							IsInAutoJoin = False;
							IsInAutoJoinTimer = Now;
							IsTeamReady = False;
							Label_AutoJoin.Value = "{{{RoyalSquad_STARTMATCHMAKING_Text}}}";
							G_Label_AutoFill.Value = "{{{RoyalSquad_Ready_Text}}}";
						}
						UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
					}
					else if(Event.ControlId == "button-teamready"){
						declare Button_AutoFillTeam <=> (G_Frame_Globale.GetFirstChild("button-teamready") as CMlQuad);
						declare Button_AutoFillContour <=> (G_Frame_Globale.GetFirstChild("button-autofillteamcontour") as CMlQuad);
						declare Frame_AutoFillTeam <=> (G_Frame_Globale.GetFirstChild("frame-autofillteam") as CMlFrame);
						declare Label_AutoJoin <=>(G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						if(G_Label_AutoFill.Value == "{{{RoyalSquad_Ready_Text}}}" && SquadForClient.count > 0){
							G_Label_AutoFill.Value = "{{{RoyalSquad_Cancel_Text}}}";
							IsTeamReady = True;
							if(G_PublicTeamCheck){
								SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_TeamIsReadyToPlay}}}", [LocalUser.Login]);
								if(SquadForClient.count < G_MatesNumberSet){
									SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_TeamInAutoFill}}}", [LocalUser.Login]);
								}
								IsInAutoFill = True;
								IsInAutoFillTimer = Now;
							} else if (G_PrivateTeamCheck){
								SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_TeamIsReadyToPlay}}}", [LocalUser.Login]);
								SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_CancelTeamInAutoFill}}}", [LocalUser.Login]);
							}
							G_Frame_LeaveSquadButton.Visible						= False;
							UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
						}
						else if (G_Label_AutoFill.Value == "{{{RoyalSquad_Cancel_Text}}}"){
							SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_CancelTeamIsReadyToPlay}}}", [LocalUser.Login]);
							SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_CancelTeamInAutoFill}}}", [LocalUser.Login]);
							G_Label_AutoFill.Value = "{{{RoyalSquad_Ready_Text}}}";
							G_Frame_LeaveSquadButton.Visible						= True;
							IsInAutoFill = False;
							IsTeamReady = False;
							IsInAutoFillTimer = Now;
							UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
							PlayerListUpdate = True;
							G_Frame_BuddiesList.Visible		= False;
							G_Frame_ListPlayers.Visible		= True;
							if(PlayerList.count > 10 && !G_Frame_BuddiesList.Visible){
								G_Frame_Pager.Visible					= True;
								PlayerListUpdate = True;
							}
							G_Frame_BuddiesPager.Visible	= False;
							HandleUI_SelectionOnBuddies(False, BuddiesInServer);
						}
						else if(G_Label_AutoFill.Value == "{{{RoyalSquad_Ready_Text}}}" && SquadForClient.count == 0){
							SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_PlayerInAutoJoin}}}", [LocalUser.Login]);
							PlayerListUpdate = True;
							IsInAutoJoin = True;
							IsInAutoJoinTimer = Now;
							Label_AutoJoin.Value = "{{{RoyalSquad_Cancel_Text}}}";
						}
					}
					else if (Event.ControlId == "button-leaveteam-icon" || Event.ControlId == "leave-squad-button"){
						SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_LeaveTeam}}}", [LocalUser.Login]);
						SendCustomEvent("{{{Const::C_UI_Event_TeamSelection_CancelTeamIsReadyToPlay}}}", [LocalUser.Login]);
						declare Frame_SquadMember <=> Event.Control.Parent;
						declare Label_TeamStatus <=> (G_Frame_TeamStatus.GetFirstChild("label-TeamStatus") as CMlLabel);
						G_Frame_LeaveSquadButton.Visible	= False;
						IsMouseOver = False;
						IsTeamReady = False;
						IsInAutoFill = False;
						G_UseTeamCreation = False;
						IsInAutoFillTimer = Now;
						PlayerInvited.clear();
						IsLeader = False;
						InATeamForMode = False;
						IsInAutoJoin = False;
						InATeamForModeTimer = Now;
						IsInAutoJoinTimer = Now;
						G_PrivateTeamCheck = False;
						G_Label_AutoFill.Value = "{{{RoyalSquad_Ready_Text}}}";
						Label_TeamStatus.Value = "{{{RoyalSquad_PublicTeam_Text}}}";
						UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
						Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, 1, IsClicked, G_Frame_ListPlayers.Visible);
						PlayerListUpdate = True;
						if(PrevIsLeader != IsLeader){
							IsLeaderChangeTimer = Now;
							PrevIsLeader = IsLeader;
						}
					}
					else if (Event.ControlId == "button-page-next") {
						Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, Page + 1, IsClicked, G_Frame_ListPlayers.Visible);
						BuddiesPage = UpdateBuddiesPager(G_Frame_BuddiesPager, G_Frame_BuddiesList.Controls.count, BuddiesList.count, 1, IsClicked);
						PlayerListUpdate = True;
					}
					else if (Event.ControlId == "button-page-prev") {
						Page = UpdatePager(G_Frame_Pager, G_Frame_ListPlayers.Controls.count, PlayerList.count, Page - 1, IsClicked, G_Frame_ListPlayers.Visible);
						PlayerListUpdate = True;
					} 
					else if(Event.ControlId == "button-Buddiespage-prev"){
						BuddiesPage = UpdateBuddiesPager(G_Frame_BuddiesPager, G_Frame_BuddiesList.Controls.count, BuddiesList.count, BuddiesPage - 1, IsClicked);
					}
					else if(Event.ControlId == "button-Buddiespage-next"){
						BuddiesPage = UpdateBuddiesPager(G_Frame_BuddiesPager, G_Frame_BuddiesList.Controls.count, BuddiesList.count, BuddiesPage + 1, IsClicked);
					}
					else if (Event.ControlId == "button-player" || Event.ControlId == "quad-invitecontour") {
						PlayerListUpdate = True;
						declare Frame_PlayerSelected <=> Event.Control.Parent;
						declare Text LoginOfSelected;
						
						declare TeamSelection_Login for Event.Control = "";
						declare Label_PlayerName <=> (Frame_PlayerSelected.GetFirstChild("label-name") as CMlLabel);
						
						if (LocalUser.Login != TeamSelection_Login) {
							LoginOfSelected	= GetLoginFromName(Label_PlayerName.Value);
							if(!PlayerInvited.exists(LoginOfSelected)){
								PlayerInvited.add(LoginOfSelected);
							}
							SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_SelectPlayer}}}", [LoginOfSelected]);
						}
					}
					else if (Event.ControlId == "button-buddies" || Event.ControlId == "quad-buddyinvitecontour" ) {
						PlayerListUpdate = True;
						declare Frame_PlayerSelected <=> Event.Control.Parent;
						declare Text LoginOfSelected;
						
						declare TeamSelection_Login for Event.Control = "";
						declare Label_PlayerName <=> (Frame_PlayerSelected.GetFirstChild("label-buddyname") as CMlLabel);
						
						LoginOfSelected	= GetLoginFromName(Label_PlayerName.Value);
						if (LocalUser.Login != LoginOfSelected) {
							if(!PlayerInvited.exists(LoginOfSelected)){
								PlayerInvited.add(LoginOfSelected);
							}
							SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_SelectPlayer}}}", [LoginOfSelected]);
						}
					}
					else if (Event.ControlId == "button-requester") {
						declare Frame_Requester <=> Event.Control.Parent;
						declare Quad_Requester_MouseOver <=> (Frame_Requester.GetFirstChild("quad-RequesterOver") as CMlQuad);
						declare Label_RequesterName <=> (Frame_Requester.GetFirstChild("label-requester") as CMlLabel);
						declare Quad_RequestImg <=> (Frame_Requester.GetFirstChild("quad-requestimg") as CMlQuad);

						declare RequesterLogin = GetLoginFromName(Label_RequesterName.Value);
						declare RequesterPlayer <=> GetPlayerFromName(RequesterLogin);
						if (RequesterPlayer != Null) {
							SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_AcceptRequest}}}", [RequesterLogin]);
							if(PlayersJoined.exists(RequesterLogin)){
								PlayersJoined.add(RequesterLogin);
							}
						}
					}
					if (Event.ControlId == "button-playerlist") {
						declare Frame_MenuPlayerList <=> (G_Frame_Globale.GetFirstChild("frame-menu-playerslist") as CMlFrame);
						declare Header_InvitationList <=> (G_Frame_Globale.GetFirstChild("frame-menu-invitationlist") as CMlFrame);
						declare Frame_AddPlayer <=> (G_Frame_Globale.GetFirstChild("frame-menu-buttoncreate") as CMlFrame);
						declare Img_AddPlayerPng <=> (Frame_AddPlayer.GetFirstChild("button-playerlistpng") as CMlQuad);
						declare Frame_AutoJoin <=> (G_Frame_Globale.GetFirstChild("frame-autojointeam") as CMlFrame);
						G_SortInTeamPlayersLast = True;
						PlayerListUpdate = True;
						G_PrivateTeamCheck = False;
						UpdateSquadMembers(G_Frame_SquadMembers, SquadForClient, IsPlayersUpdated, IsMouseOver, Net_S_PlayersPerTeam, LocalUser.Login, IsInAutoFill, IsInAutoJoin, IsTeamReady, IsLeader, G_PrivateTeamCheck);
						if(IsLeader){
							continue;
						}
						G_Frame_Menu_PlayerListHeaderFooter.Visible = !G_Frame_Menu_PlayerListHeaderFooter.Visible;
						IsClicked = !IsClicked;
						G_Frame_AutoFillTeam.Visible = True;						
						G_Label_AlertNeedMates.Visible = True;
						Frame_ListInvitation.Visible = !Frame_ListInvitation.Visible;
						Frame_SquadMembers.Visible = !Frame_SquadMembers.Visible;
						Frame_AutoJoin.Visible = !Frame_AutoJoin.Visible;
						Header_InvitationList.Visible = !Header_InvitationList.Visible;
						G_Frame_LeaveSquadButton.Visible 	= True;
						G_Button_AutoFillTeam.Visible 		= True;
						G_Quad_ContourAutoFill.Opacity = 0.3;
						if(BuddiesInServer.count == 0){
							G_Frame_BuddiesList.Visible = False;
							G_Button_BuddiesList.Visible = False;
							G_Label_BuddiesOnglet.Opacity = 0.5;
							G_Frame_ListPlayers.Visible = True;
							if(PlayerList.count > 10 && !G_Frame_BuddiesList.Visible){
								G_Frame_Pager.Visible					= True;
							} else G_Frame_Pager.Visible		= False;
							HandleUI_SelectionOnBuddies(False, BuddiesInServer);
						} else {
							G_Frame_BuddiesList.Visible = True;
							G_Frame_ListPlayers.Visible = False;
							G_Button_BuddiesList.Visible = True;
							G_Label_BuddiesOnglet.Opacity = 1.;
							HandleUI_SelectionOnBuddies(True, BuddiesInServer);
						}
						if(G_Label_HomeMenu.Value == "Leave team creation"){
							SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_LeaveTeamCreation}}}", [LocalUser.Login]);
							
							PlayerInvited.clear();
							G_HeaderMainSquad.Visible					= False;
							UpdatePlayerList(G_Frame_ListPlayers, PlayerList, Page, PlayerInvited, Client_AllPlayersInTeamList, G_Label_MateSearched.Value, G_SortInTeamPlayersLast, SquadForClient);
						} else if (G_Label_HomeMenu.Value == "{{{RoyalSquad_CreateTeam_Text}}}"){
							G_HeaderMainSquad.Visible					= True;
							Frame_AddPlayer.Visible 					= False;
							G_Frame_LeaveSquadButton.Visible	= True;
							G_Frame_MenuTop.Visible						= False;
							SendCustomEvent("{{{Const::C_UIEvent_TeamSelection_OpenTeamCreation}}}", [LocalUser.Login]);
							G_PublicTeamCheck = True;
							G_NewTeamStatusTimer = Now;
							G_UseTeamCreation = True;
						}
						if(G_Frame_ListPlayers.Visible){
							G_Label_HomeMenu.Value = "Leave team creation";
						} else G_Label_HomeMenu.Value = "{{{RoyalSquad_CreateTeam_Text}}}";
					}
				}
				case CMlScriptEvent::Type::MouseOver: {
					if(Event.ControlId == "button-teamready"){
						declare Frame_AutoFillMenu <=> (G_Frame_Globale.GetFirstChild("frame-teamready") as CMlFrame);
						declare Button_AutoFillContour <=> (Frame_AutoFillMenu.GetFirstChild("button-autofillteamcontour") as CMlQuad);
						
						G_Quad_ContourAutoFill.Visible = True;
						G_IsMouseOver_TeamReady = True;
						G_Button_AutoFillTeam.Opacity = 1.;
						G_Button_AutoFillTeam.BgColor = CL::HexToRgb("000F");
					}
					if(Event.ControlId == "button-switchStatus1" || Event.ControlId == "button-switchStatus2" || Event.ControlId == "button-addmate" || Event.ControlId == "button-removemate" || Event.ControlId == "button-page-prev" || Event.ControlId == "button-page-next"){
						declare Frame_Over <=> (Event.Control.Parent);
						declare CMlQuad Quad_Over;
						if(Event.ControlId == "button-switchStatus1"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-switchStatus1") as CMlQuad);
							Quad_Over.Opacity = 1.;
						} else if (Event.ControlId == "button-switchStatus2"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-switchStatus2") as CMlQuad);
							Quad_Over.Opacity = 1.;
						} else if(Event.ControlId == "button-addmate"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-addmate") as CMlQuad);
							Quad_Over.Opacity = 1.;
						} else if(Event.ControlId == "button-removemate"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-removemate") as CMlQuad);
							Quad_Over.Opacity = 1.;
						} else if(Event.ControlId == "button-page-prev"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("button-page-prev") as CMlQuad);
							Quad_Over.Opacity = 1.;
						} else if (Event.ControlId == "button-page-next"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("button-page-next") as CMlQuad);
							Quad_Over.Opacity = 1.;
						}
					}
					if(Event.ControlId == "leave-squad-button"){
						G_IsMouseOver_LeaveTeam = True;
						G_Quad_LeaveSquad.Opacity = 1.;
						G_Quad_LeaveSquad.BgColor = CL::HexToRgb("000F");
					}
					if(Event.ControlId == "quad-buddieslist"){
						if(!BuddiesOnServer){
							G_Label_NoBuddies_Notif.Visible = True;
							G_Label_NoBuddies_Notif.Opacity = 1.;
						}
					}
					if(Event.ControlId == "button-buddieslist"){
						if(!G_Frame_BuddiesList.Visible){
							G_Quad_BuddiesList.Opacity = 1.;
						}
					}
					if(Event.ControlId == "button-playerslist"){
						if(!G_Frame_ListPlayers.Visible){
							G_Quad_Onglet_PlayersList.Opacity = 1.;
						}
					}
					if(Event.ControlId == "button-cancelautojoin"){
						declare Quad_ContourCancelAutoJoin <=> (G_Frame_Globale.GetFirstChild("quad-contourcancelautojoin") as CMlQuad);
						Quad_ContourCancelAutoJoin.Visible = True;
					}
					if(Event.ControlId == "button-autojoin"){
						declare Quad_ButtonAutoJoin <=> (G_Frame_Globale.GetFirstChild("button-autojoin") as CMlQuad);
						declare Label_AutoJoin <=> (G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						G_IsMouseOver_AutoJoin = True;
						Quad_ButtonAutoJoin.Opacity = 1.;
						Quad_ButtonAutoJoin.BgColor = CL::HexToRgb("000000FF");
						Label_AutoJoin.Opacity = 1.0;
					}
					if(Event.ControlId == "button-playerlist"){
						declare Quad_ButtonCreateTeam <=> (G_Frame_Globale.GetFirstChild("button-playerlist") as CMlQuad);
						declare Label_AutoJoin <=> (G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						G_IsMouseOver_CreateTeam = True;
						G_Quad_ContourCreateTeam.Visible = True;
						Quad_ButtonCreateTeam.Opacity = 1.;
						Quad_ButtonCreateTeam.BgColor = CL::HexToRgb("000000FF");
					}
					if(Event.ControlId == "button-player" || Event.ControlId == "quad-invitecontour"){
						declare Frame_Player <=> Event.Control.Parent;
						declare Quad_MouseOver <=> (Frame_Player.GetFirstChild("quad-OnOver") as CMlQuad);
						declare Label_PlayerName <=> (Frame_Player.GetFirstChild("label-name") as CMlLabel);
						declare Label_PlayerBracket <=> (Frame_Player.GetFirstChild("label-bracket") as CMlLabel);
						declare Label_ClickToInvite <=> (Frame_Player.GetFirstChild("label-clicktoinvite") as CMlLabel);
						Label_ClickToInvite.Visible = True;
						Label_PlayerName.Opacity = 1.;
						Quad_MouseOver.Visible = True;
					}
					if(Event.ControlId == "button-buddies" || Event.ControlId == "quad-buddyinvitecontour"){
						declare Frame_Buddy <=> Event.Control.Parent;
						declare Quad_MouseOver <=> (Frame_Buddy.GetFirstChild("quad-buddyOnOver") as CMlQuad);
						declare Label_PlayerName <=> (Frame_Buddy.GetFirstChild("label-buddyname") as CMlLabel);
						declare Label_PlayerBracket <=> (Frame_Buddy.GetFirstChild("label-buddybracket") as CMlLabel);
						Label_PlayerName.Opacity = 1.;
						Quad_MouseOver.Visible = True;
					}
					if(Event.ControlId == "button-requester"){
						declare Frame_Requester <=> Event.Control.Parent;
						declare Quad_Requester_MouseOver <=> (Frame_Requester.GetFirstChild("quad-RequesterOver") as CMlQuad);
						declare Label_RequesterName <=> (Frame_Requester.GetFirstChild("label-requester") as CMlLabel);
						declare Quad_RequestImg <=> (Frame_Requester.GetFirstChild("quad-requestimg") as CMlQuad);
						declare Label_ClickToAccept <=> (Frame_Requester.GetFirstChild("label-clicktoaccept") as CMlLabel);
						Label_ClickToAccept.Visible = True;
						Label_RequesterName.TextColor = <1., 1., 1.>;
						Quad_RequestImg.Opacity = 1.;
						Quad_RequestImg.BgColor = CL::HexToRgb("000F");
						Quad_Requester_MouseOver.Visible = True;
					}
					if(Event.ControlId == "button-sortplayerslist"){
						G_Button_SortPlayersList.Opacity = 1.;
						G_Button_SortPlayersList.BgColor = CL::HexToRgb("000000FF");
					}
				}
				case CMlScriptEvent::Type::MouseOut: {
					if(Event.ControlId == "button-teamready"){
						declare Frame_AutoFillMenu <=> (G_Frame_Globale.GetFirstChild("frame-teamready") as CMlFrame);
						declare Button_AutoFillContour <=> (Frame_AutoFillMenu.GetFirstChild("button-autofillteamcontour") as CMlQuad);
						G_IsMouseOver_TeamReady = False;
						G_X = 0.;
						G_Button_AutoFillTeam.Opacity = 0.3;
						G_Button_AutoFillTeam.BgColor = CL::HexToRgb("1A1A1AFF"); 
						G_Quad_ContourAutoFill.Opacity = 1.;
					}
					if(Event.ControlId == "button-switchStatus1" || Event.ControlId == "button-switchStatus2" || Event.ControlId == "button-addmate" || Event.ControlId == "button-removemate" || Event.ControlId == "button-page-prev" || Event.ControlId == "button-page-next"){
						declare Frame_Over <=> (Event.Control.Parent);
						declare CMlQuad Quad_Over;
						if(Event.ControlId == "button-switchStatus1"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-switchStatus1") as CMlQuad);
							Quad_Over.Opacity = 0.3;
						} else if (Event.ControlId == "button-switchStatus2"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-switchStatus2") as CMlQuad);
							Quad_Over.Opacity = 0.3;
						} else if(Event.ControlId == "button-addmate"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-addmate") as CMlQuad);
							Quad_Over.Opacity = 0.3;
						} else if(Event.ControlId == "button-removemate"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("label-removemate") as CMlQuad);
							Quad_Over.Opacity = 0.3;
						} else if(Event.ControlId == "button-page-prev"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("button-page-prev") as CMlQuad);
							Quad_Over.Opacity = 0.3;
						} else if (Event.ControlId == "button-page-next"){
							declare Quad_Over <=> (Frame_Over.GetFirstChild("button-page-next") as CMlQuad);
							Quad_Over.Opacity = 0.3;
						}
					}
					if(Event.ControlId == "leave-squad-button"){
						G_IsMouseOver_LeaveTeam = False;
						G_Quad_LeaveSquad.Opacity = 0.3;
						G_Quad_LeaveSquad.BgColor = CL::HexToRgb("1A1A1AFF"); 
					}
					if(Event.ControlId == "quad-buddieslist"){
						G_Label_NoBuddies_Notif.Opacity = 1.;
						G_Label_NoBuddies_Notif.Visible = False;
					}
					if(Event.ControlId == "button-cancelautojoin"){
						declare Quad_ContourCancelAutoJoin <=> (G_Frame_Globale.GetFirstChild("quad-contourcancelautojoin") as CMlQuad);
						Quad_ContourCancelAutoJoin.Visible = False;
					}
					if(Event.ControlId == "button-autojoin"){
						declare Quad_ButtonAutoJoin <=> (G_Frame_Globale.GetFirstChild("button-autojoin") as CMlQuad);
						declare Label_AutoJoin <=> (G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						G_IsMouseOver_AutoJoin = False;
						G_X = 0.;
						G_Quad_ContourAutoJoin.Opacity = 1.;
						Quad_ButtonAutoJoin.Opacity = 0.3;
						Quad_ButtonAutoJoin.BgColor = CL::HexToRgb("1A1A1AFF");
						Label_AutoJoin.Opacity = 1.0;
					}
					if(Event.ControlId == "button-playerlist"){
						declare Quad_ButtonCreateTeam <=> (G_Frame_Globale.GetFirstChild("button-playerlist") as CMlQuad);
						declare Label_AutoJoin <=> (G_Frame_Globale.GetFirstChild("label-autojoin") as CMlLabel);
						G_IsMouseOver_CreateTeam = False;
						G_X = 0.;
						G_Quad_ContourCreateTeam.Visible = True;
						G_Quad_ContourCreateTeam.Opacity = 1.;
						Quad_ButtonCreateTeam.Opacity = 0.3;
						Quad_ButtonCreateTeam.BgColor = CL::HexToRgb("1A1A1AFF");
					}
					if(Event.ControlId == "button-buddies" || Event.ControlId == "quad-buddyinvitecontour"){
						declare Frame_Buddy <=> Event.Control.Parent;
						declare Quad_MouseOver <=> (Frame_Buddy.GetFirstChild("quad-buddyOnOver") as CMlQuad);
						declare Label_PlayerName <=> (Frame_Buddy.GetFirstChild("label-buddyname") as CMlLabel);
						declare Label_PlayerBracket <=> (Frame_Buddy.GetFirstChild("label-buddybracket") as CMlLabel);
						Label_PlayerName.Opacity = 0.8;
						Quad_MouseOver.Visible = False;	
					}
					if(Event.ControlId == "button-player" || Event.ControlId == "quad-invitecontour"){
						declare Frame_Player <=> Event.Control.Parent;
						declare Quad_MouseOver <=> (Frame_Player.GetFirstChild("quad-OnOver") as CMlQuad);
						declare Label_PlayerName <=> (Frame_Player.GetFirstChild("label-name") as CMlLabel);
						declare Label_PlayerBracket <=> (Frame_Player.GetFirstChild("label-bracket") as CMlLabel);
						declare Label_ClickToInvite <=> (Frame_Player.GetFirstChild("label-clicktoinvite") as CMlLabel);
						Label_ClickToInvite.Visible = False;
						Label_PlayerName.Opacity = 0.8;
						Quad_MouseOver.Visible = False;	
					}
					if(Event.ControlId == "button-requester"){
						declare Frame_Requester <=> Event.Control.Parent;
						declare Quad_Requester_MouseOver <=> (Frame_Requester.GetFirstChild("quad-RequesterOver") as CMlQuad);
						declare Label_RequesterName <=> (Frame_Requester.GetFirstChild("label-requester") as CMlLabel);
						declare Quad_RequestImg <=> (Frame_Requester.GetFirstChild("quad-requestimg") as CMlQuad);
						declare Label_ClickToAccept <=> (Frame_Requester.GetFirstChild("label-clicktoaccept") as CMlLabel);
						Label_ClickToAccept.Visible = False;
						Label_RequesterName.TextColor = <0.5, 0.5, 0.5>;
						Quad_RequestImg.Opacity = .3;
						Quad_RequestImg.BgColor = CL::HexToRgb("1A1A1AFF");
						Quad_Requester_MouseOver.Visible = False;
					}
					if(Event.ControlId == "button-sortplayerslist"){
						G_Button_SortPlayersList.Opacity = 0.3;
						G_Button_SortPlayersList.BgColor = CL::HexToRgb("1A1A1AFF");
					}
					if(Event.ControlId == "button-buddieslist"){
						if(!G_Frame_BuddiesList.Visible){
							G_Quad_BuddiesList.Opacity = 0.3;
						}
					}
					if(Event.ControlId == "button-playerslist"){
						if(!G_Frame_ListPlayers.Visible){
							G_Quad_Onglet_PlayersList.Opacity = 0.3;
						}
					}
				}
			}		
		}
	}
}
		--></script>
	</manialink>
	""";
}

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// Public
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
/// Update library
Void Yield() {
	foreach (Event in PendingEvents) {
		if (Event.Type == CManiaAppPlaygroundEvent::Type::LayerCustomEvent) {
			if (
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_SelectPlayer ||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_AcceptRequest||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_MemberInTeam ||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_AllPlayersInTeam ||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_LeaderInFullTeam ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_TeamInAutoFill	||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_LeaveTeamCreation	||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_InvitersToDestroyUpdated ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_LeaveTeam ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_PlayerInAutoJoin ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_PlayerCancelAutoJoin ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_CancelTeamInAutoFill	||
				Event.CustomEventType == Const::C_UIEvent_TeamSelection_OpenTeamCreation ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_NeedHelp ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_TeamIsReadyToPlay ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_CancelTeamIsReadyToPlay ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_AddMembersNumbers ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_RemoveMembersNumbers ||
				Event.CustomEventType == Const::C_UI_Event_TeamSelection_ResetMembersNumbers
			) {
				declare EventData = Text[];
				foreach (Value in Event.CustomEventData) EventData.add(Value);
				SendCustomEvent(Event.CustomEventType, EventData);
			}
		}
	}
}



// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
/// Unload the library
Void Unload() {

}

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //
/// Load the library
Void Load() {
	Unload();
	Layers::Create(C_Layer_TeamSelection, Private_GetTeamSelectionML());
}